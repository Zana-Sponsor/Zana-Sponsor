<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZANA EXCHANGE | Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;500;800&display=swap');
        :root { --accent: #00d2ff; --bg: #0b0e14; --card: #161b22; --border: #30363d; --text: #ffffff; }
        
        body { font-family: 'Vazirmatn', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; height: 100vh; }

        /* ğŸ“ Sidebar - User List */
        .sidebar { width: 300px; background: var(--card); border-left: 1px solid var(--border); display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; background: #000; text-align: center; border-bottom: 1px solid var(--border); }
        .user-list { flex: 1; overflow-y: auto; }
        .user-item { padding: 15px; border-bottom: 1px solid var(--border); cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 10px; }
        .user-item:hover { background: #21262d; }
        .user-item.active { border-right: 4px solid var(--accent); background: #1c2128; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; background: #888; }
        .online { background: #2ecc71; box-shadow: 0 0 10px #2ecc71; }

        /* ğŸ’¬ Chat Section */
        .chat-area { flex: 1; display: flex; flex-direction: column; background: #0d1117; }
        .chat-header { padding: 15px 25px; background: var(--card); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        #chatBody { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px 15px; border-radius: 12px; max-width: 70%; font-size: 14px; }
        .sent { align-self: flex-end; background: var(--accent); color: #000; font-weight: bold; }
        .received { align-self: flex-start; background: #21262d; color: #fff; }

        /* âš™ï¸ Control Panel */
        .controls { width: 350px; background: var(--card); border-right: 1px solid var(--border); padding: 20px; overflow-y: auto; }
        .order-card { background: #0d1117; border-radius: 15px; padding: 15px; border: 1px solid var(--border); margin-bottom: 15px; font-size: 13px; }
        .btn { padding: 8px 15px; border: none; border-radius: 8px; cursor: pointer; font-family: 'Vazirmatn'; font-weight: bold; margin: 5px; }
        .btn-success { background: #2ecc71; color: #000; }
        .btn-danger { background: #ff4d4d; color: #fff; }
        .btn-block { background: #e74c3c; width: 100%; margin-top: 20px; }

        .chat-input-area { padding: 15px; background: var(--card); display: flex; gap: 10px; }
        input { flex: 1; background: #21262d; border: 1px solid var(--border); padding: 12px; color: #fff; border-radius: 10px; outline: none; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header"><h3>Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±Ø§Ù†</h3></div>
        <div class="user-list" id="userList">
            <p style="text-align:center; opacity:0.5;">Ø¨Ø§Ø± Ø¯Û•Ø¨ÛØª...</p>
        </div>
    </div>

    <div class="chat-area">
        <div class="chat-header">
            <div id="targetUserInfo">
                <b id="targetName">Ú©Û•Ø³ÛÚ© Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</b><br>
                <small id="targetID" style="opacity:0.6;">---</small>
            </div>
            <div>
                <button class="btn btn-danger" onclick="blockUser()"><i class="fas fa-ban"></i> Ø¨Ù„Û†Ú© Ú©Ø±Ø¯Ù†</button>
            </div>
        </div>
        <div id="chatBody"></div>
        <div class="chat-input-area">
            <input type="text" id="adminInput" placeholder="Ù†Ø§Ù…Û•ÛŒÛ•Ú© Ø¨Ù†ÙˆÙˆØ³Û•...">
            <button class="btn btn-success" onclick="sendAdminMsg()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <div class="controls">
        <h3>Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†</h3>
        <div id="orderList">
            <p style="opacity:0.5;">ØªÚ©Ø§ÛŒÛ• Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±ÛÚ© Ù‡Û•ÚµØ¨Ú˜ÛØ±Û• Ø¨Û† Ø¨ÛŒÙ†ÛŒÙ†ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†ÛŒ</p>
        </div>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyB056_g2Y3AJjtjG9715FgtXIhtjFcMPPU", databaseURL: "https://zana-exchange-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentUserID = null;

    // 1ï¸âƒ£ Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ù„ÛŒØ³ØªÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±Ø§Ù†
    db.ref('users').on('value', snap => {
        const list = document.getElementById('userList');
        list.innerHTML = "";
        snap.forEach(child => {
            const user = child.val();
            const div = document.createElement('div');
            div.className = `user-item ${currentUserID === child.key ? 'active' : ''}`;
            div.onclick = () => selectUser(child.key, user.name);
            div.innerHTML = `
                <div class="status-dot online"></div>
                <div>
                    <b>${user.name}</b><br>
                    <small>${user.email}</small>
                </div>
            `;
            list.appendChild(div);
        });
    });

    // 2ï¸âƒ£ Ù‡Û•ÚµØ¨Ú˜Ø§Ø±Ø¯Ù†ÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±
    function selectUser(uid, name) {
        currentUserID = uid;
        document.getElementById('targetName').innerText = name;
        document.getElementById('targetID').innerText = "ID: " + uid;
        loadChat(uid);
        loadUserOrders(uid);
    }

    // 3ï¸âƒ£ Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Øª
    function loadChat(uid) {
        db.ref('chats/' + uid).on('value', snap => {
            const body = document.getElementById('chatBody');
            body.innerHTML = "";
            snap.forEach(c => {
                const m = c.val();
                const type = m.sender === 'admin' ? 'sent' : 'received';
                body.innerHTML += `<div class="msg ${type}">${m.text}</div>`;
            });
            body.scrollTop = body.scrollHeight;
        });
    }

    // 4ï¸âƒ£ Ù†Ø§Ø±Ø¯Ù†ÛŒ Ù†Ø§Ù…Û•ÛŒ Ø¦Ø§Ø¯Ù…ÛŒÙ†
    function sendAdminMsg() {
        const txt = document.getElementById('adminInput').value;
        if(!txt || !currentUserID) return;
        db.ref('chats/' + currentUserID).push({
            sender: 'admin',
            text: txt,
            time: Date.now()
        });
        document.getElementById('adminInput').value = "";
    }

    // 5ï¸âƒ£ Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†ÛŒ Ø¦Û•Ùˆ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±Û•
    function loadUserOrders(uid) {
        db.ref('users/' + uid).once('value', uSnap => {
            const email = uSnap.val().email;
            db.ref('orders').orderByChild('uEmail').equalTo(email).on('value', snap => {
                const list = document.getElementById('orderList');
                list.innerHTML = "";
                snap.forEach(c => {
                    const o = c.val();
                    list.innerHTML += `
                        <div class="order-card">
                            <b>ID: ${c.key}</b><hr>
                            Ø¨Ú•: ${o.total}<br>
                            Ø¨Û†: ${o.userPhone}<br>
                            Ø¯Û†Ø®: <span style="color:orange">${o.status}</span><br><br>
                            <button class="btn btn-success" onclick="updateStatus('${c.key}', 'ÙˆÛ•Ø±Ú¯ÛŒØ±Ø§ âœ…')">Ù‚Ø¨ÙˆÚµ</button>
                            <button class="btn btn-danger" onclick="updateStatus('${c.key}', 'Ú•Û•ØªÚ©Ø±Ø§ÛŒÛ•ÙˆÛ• âŒ')">Ú•Û•ØªÚ©Ø±Ø¯Ù†Û•ÙˆÛ•</button>
                        </div>
                    `;
                });
            });
        });
    }

    // 6ï¸âƒ£ Ú¯Û†Ú•ÛŒÙ†ÛŒ Ø¯Û†Ø®ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ
    function updateStatus(oid, status) {
        db.ref('orders/' + oid).update({ status: status });
    }

    // 7ï¸âƒ£ Ø¨Ù„Û†Ú© Ú©Ø±Ø¯Ù†ÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±
    function blockUser() {
        if(!currentUserID) return;
        if(confirm("Ø¯ÚµÙ†ÛŒØ§ÛŒ Ù„Û• Ø¨Ù„Û†Ú© Ú©Ø±Ø¯Ù†ÛŒ Ø¦Û•Ù… Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±Û•ØŸ")) {
            db.ref('users/' + currentUserID).update({ isBlocked: true });
            alert("Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø± Ø¨Ù„Û†Ú© Ú©Ø±Ø§!");
        }
    }
</script>
</body>
</html>
