<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ZANA ADMIN PRO | ÙˆÛ•Ø´Ø§Ù†ÛŒ Ú©Û†ØªØ§ÛŒÛŒ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');
        :root { --p: #00d2ff; --bg: #050505; --c: #121212; --b: #222; --t: #fff; }
        body { font-family: 'Vazirmatn'; background: var(--bg); color: var(--t); margin: 0; padding: 20px; }
        .dashboard { display: grid; grid-template-columns: 300px 1fr 300px; gap: 20px; height: 90vh; }
        .box { background: var(--c); border: 1px solid var(--b); border-radius: 15px; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; }
        .btn { padding: 8px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; margin: 2px; font-family: 'Vazirmatn'; }
        .btn-ok { background: #2ecc71; color: #fff; }
        .btn-no { background: #e74c3c; color: #fff; }
        .btn-del { background: #555; color: #fff; }
        
        /* Ú†Ø§Øª */
        .chat-area { flex: 1; background: #000; border-radius: 10px; margin: 10px 0; padding: 10px; display: flex; flex-direction: column; }
        .m { padding: 8px; border-radius: 8px; margin-bottom: 5px; font-size: 13px; max-width: 85%; }
        .m.in { background: #222; align-self: flex-start; }
        .m.out { background: var(--p); color: #000; align-self: flex-end; }
        
        input { background: #1a1a1a; border: 1px solid var(--b); color: #fff; padding: 10px; border-radius: 8px; margin-top: 5px; }
        .user-row { padding: 10px; border-bottom: 1px solid #222; cursor: pointer; font-size: 13px; }
        .user-row:hover { background: #1a1a1a; }
        .active-user { border-right: 4px solid var(--p); background: #1a1a1a; }
    </style>
</head>
<body>

<div class="dashboard">
    <div class="box">
        <h3>ğŸ‘¥ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±Ø§Ù†</h3>
        <div id="userList"></div>
    </div>

    <div class="box">
        <h3 id="chatWith">ğŸ’¬ Ú†Ø§ØªÛŒ Ú•Ø§Ø³ØªÛ•ÙˆØ®Û†</h3>
        <div class="chat-area" id="adminChatBody">Ú©Ú•ÛŒØ§Ø±ÛÚ© Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•...</div>
        <div style="display:flex; gap:5px;">
            <input type="text" id="adminMsgInp" style="flex:1" placeholder="ÙˆÛ•ÚµØ§Ù… Ø¨Ù†ÙˆÙˆØ³Û•...">
            <button class="btn btn-ok" onclick="sendAdminMsg()">Ù†Ø§Ø±Ø¯Ù†</button>
        </div>
        <hr style="width:100%; border:0; border-top:1px solid #333; margin:20px 0;">
        <h3>ğŸ“¥ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†</h3>
        <div id="orderList"></div>
    </div>

    <div class="box">
        <h3>âš™ï¸ Ú©Û†Ù†ØªÚ•Û†Úµ</h3>
        <p>Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±ÛŒ Marquee:</p>
        <input type="text" id="marqueeTxt">
        <button class="btn btn-ok" onclick="setUpdate('alertMsg', {show:true, text:document.getElementById('marqueeTxt').value})">Ø¨ÚµØ§ÙˆÚ©Ø±Ø¯Ù†Û•ÙˆÛ•</button>
        <button class="btn btn-del" onclick="setUpdate('alertMsg', {show:false})">Ù„Ø§Ø¨Ø±Ø¯Ù†</button>
        
        <p>Ù‚ÙˆÙÚµÚ©Ø±Ø¯Ù†ÛŒ Ø¦Û•Ù¾:</p>
        <button class="btn btn-no" style="width:100%" onclick="setUpdate('appStatus', {locked:true})">ğŸ”´ Lock App</button>
        <button class="btn btn-ok" style="width:100%" onclick="setUpdate('appStatus', {locked:false})">ğŸŸ¢ Unlock App</button>
    </div>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyB056_g2Y3AJjtjG9715FgtXIhtjFcMPPU", databaseURL: "https://zana-exchange-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let selectedUID = null;

    // Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±Ø§Ù†
    db.ref('users').on('value', snap => {
        let h = "";
        snap.forEach(u => {
            const d = u.val();
            h += `<div class="user-row ${selectedUID==u.key?'active-user':''}" onclick="selUser('${u.key}','${d.name}')">
                <b>${d.name || 'Ø¨Û Ù†Ø§Ùˆ'}</b><br><small>${d.email}</small>
                <br><button class="btn" style="font-size:10px; background:${d.isBlocked?'#2ecc71':'#e74c3c'}" onclick="toggleBlock('${u.key}',${d.isBlocked})">${d.isBlocked?'Unblock':'Block'}</button>
            </div>`;
        });
        document.getElementById('userList').innerHTML = h;
    });

    function selUser(id, name) {
        selectedUID = id; document.getElementById('chatWith').innerText = "Ú†Ø§Øª: " + name;
        db.ref('chats/'+id).on('value', s => {
            let h = ""; s.forEach(m => {
                const md = m.val();
                h += `<div class="m ${md.sender=='admin'?'out':'in'}">${md.text}</div>`;
            });
            const b = document.getElementById('adminChatBody'); b.innerHTML = h; b.scrollTop = b.scrollHeight;
        });
    }

    function sendAdminMsg() {
        const t = document.getElementById('adminMsgInp').value;
        if(!t || !selectedUID) return;
        db.ref('chats/'+selectedUID).push({sender:'admin', text:t, time:Date.now()});
        document.getElementById('adminMsgInp').value = "";
    }

    // Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†
    db.ref('orders').on('value', snap => {
        let h = "";
        snap.forEach(o => {
            const d = o.val();
            h += `<div style="background:#1a1a1a; padding:10px; border-radius:10px; margin-bottom:5px; border-right:4px solid ${d.status=='Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†Û•'?'orange':'#2ecc71'}">
                <small>${d.time}</small><br><b>${d.uName}</b>: ${d.total}<br>
                <button class="btn btn-ok" onclick="db.ref('orders/${o.key}').update({status:'ÙˆÛ•Ø±Ú¯ÛŒØ±Ø§'})">Ù‚Ø¨ÙˆÚµ</button>
                <button class="btn btn-no" onclick="db.ref('orders/${o.key}').update({status:'Ú•Û•ØªÚ©Ø±Ø§ÛŒÛ•ÙˆÛ•'})">Ú•Û•Øª</button>
                <button class="btn btn-del" onclick="db.ref('orders/${o.key}').remove()">Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button>
            </div>`;
        });
        document.getElementById('orderList').innerHTML = h;
    });

    function setUpdate(path, val) { db.ref(path).set(val); alert("Ø¦Û•Ù†Ø¬Ø§Ù…Ø¯Ø±Ø§"); }
    function toggleBlock(uid, st) { db.ref('users/'+uid).update({isBlocked: !st}); }
</script>
</body>
</html>
