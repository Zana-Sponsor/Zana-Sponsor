<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Zana Admin Fix</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: Tahoma; background: #0f172a; color: white; padding: 20px; text-align: right; }
        .box { background: #1e293b; padding: 20px; border-radius: 15px; max-width: 500px; margin: auto; border: 1px solid #334155; }
        input, select, button { width: 100%; padding: 12px; margin-top: 10px; border-radius: 8px; border: 1px solid #334155; box-sizing: border-box; }
        button { background: #facc15; color: black; font-weight: bold; cursor: pointer; border: none; }
        .item { background: #0f172a; padding: 10px; margin-top: 10px; border-radius: 8px; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

<div class="box" id="login-div">
    <h3>چوونەژوورەوە</h3>
    <input type="password" id="pass" placeholder="پاسۆرد بنووسە">
    <button onclick="login()">چوونەژوورەوە</button>
</div>

<div class="box" id="admin-div" style="display:none;">
    <h3>زیادکردنی واڵێت و حمولە</h3>
    <input type="text" id="name" placeholder="ناوی دراو (FastPay)">
    <input type="text" id="num" placeholder="ژمارەی وەرگرتن">
    <input type="number" id="fee" step="0.01" value="0.95" placeholder="حمولە">
    <select id="type">
        <option value="both">Both</option>
        <option value="from">From</option>
        <option value="to">To</option>
    </select>
    <button onclick="saveToFirebase()">پاشەکەوتکردن</button>
    <div id="list"></div>
</div>

<script>
    const config = {
        apiKey: "AIzaSyB056_g2Y3AJjtjG9715FgtXIhtjFcMPPU",
        authDomain: "zana-exchange.firebaseapp.com",
        databaseURL: "https://zana-exchange-default-rtdb.firebaseio.com",
        projectId: "zana-exchange"
    };
    firebase.initializeApp(config);
    const db = firebase.database();

    function login() {
        if(document.getElementById('pass').value === "zana2024") {
            document.getElementById('login-div').style.display = 'none';
            document.getElementById('admin-div').style.display = 'block';
            showList();
        } else { alert("پاسۆرد هەڵەیە!"); }
    }

    function saveToFirebase() {
        const n = document.getElementById('name').value;
        const v = document.getElementById('num').value;
        const f = document.getElementById('fee').value;
        const t = document.getElementById('type').value;

        if(n && f) {
            // ئەوەی خوارەوە گرنگترین بەشە بۆ دڵنیابوون لەوەی ئیش دەکات
            db.ref('methods').push({
                name: n,
                value: v || "---",
                fee: parseFloat(f),
                type: t
            }, (error) => {
                if (error) {
                    alert("نەتوانرا پاشەکەوت بکرێت: " + error.message);
                } else {
                    alert("بە سەرکەوتوویی زیاد کرا!");
                    document.getElementById('name').value = "";
                    document.getElementById('num').value = "";
                }
            });
        } else {
            alert("ناو و حمولە بنووسە!");
        }
    }

    function showList() {
        db.ref('methods').on('value', (snap) => {
            let html = "";
            snap.forEach((child) => {
                const d = child.val();
                html += `<div class="item">
                    <span>${d.name} (${Math.round((1-d.fee)*100)}%)</span>
                    <button onclick="db.ref('methods/${child.key}').remove()" style="width:30px; padding:2px; background:red; color:white;">X</button>
                </div>`;
            });
            document.getElementById('list').innerHTML = html;
        });
    }
</script>
</body>
</html>
