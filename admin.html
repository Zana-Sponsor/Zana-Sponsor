<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zana Pro Admin | پانێڵی بەڕێوەبردن</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --main: #facc15; --bg: #0f172a; --card: #1e293b; --success: #10b981; --danger: #ef4444; }
        body { font-family: 'Tahoma', sans-serif; background: var(--bg); color: white; margin: 0; padding: 15px; text-align: right; }
        .container { max-width: 900px; margin: auto; }
        
        /* تابی بەشەکان */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 10px; }
        .tab-btn { background: #334155; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; white-space: nowrap; }
        .tab-btn.active { background: var(--main); color: #000; font-weight: bold; }

        .admin-box { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid #334155; margin-bottom: 20px; display: none; }
        .admin-box.active { display: block; }
        
        h2 { color: var(--main); font-size: 18px; border-bottom: 1px solid #334155; padding-bottom: 10px; margin-bottom: 20px; }
        
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 11px; color: #94a3b8; margin-bottom: 5px; }
        input, textarea { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #334155; background: #0f172a; color: white; outline: none; box-sizing: border-box; }
        
        .btn { background: var(--main); color: #000; border: none; padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        
        /* ستایلی ئۆردەرەکان */
        .order-card { background: #161e2d; padding: 15px; border-radius: 15px; margin-bottom: 15px; border-right: 5px solid var(--main); display: flex; justify-content: space-between; align-items: center; }
        .receipt-img { width: 60px; height: 60px; border-radius: 10px; object-fit: cover; cursor: pointer; border: 1px solid var(--main); }
        
        #fullImgModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 3000; }
        #fullImgModal img { max-width: 90%; max-height: 90%; border-radius: 10px; }

        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 2000; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="login-overlay">
    <div class="admin-box active" style="width: 300px; text-align: center;">
        <h2>Zana Admin</h2>
        <input type="password" id="passInput" placeholder="Password..." style="text-align: center; margin-bottom: 15px;">
        <button class="btn" onclick="checkPass()">Login</button>
    </div>
</div>

<div class="container">
    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('stats-tab', this)">Dashboard</button>
        <button class="tab-btn" onclick="openTab('settings-tab', this)">Settings</button>
        <button class="tab-btn" onclick="openTab('wallets-tab', this)">Wallets</button>
        <button class="tab-btn" onclick="openTab('orders-tab', this)">Orders</button>
    </div>

    <div id="stats-tab" class="admin-box active">
        <h2>Dashboard Statistics</h2>
        <div class="form-grid">
            <div style="background:rgba(250,204,21,0.1); padding:20px; border-radius:15px; text-align:center;">
                <span style="color:#94a3b8">ئۆردەری ئەمڕۆ</span><br><b id="todayOrders" style="font-size:25px; color:var(--main)">0</b>
            </div>
            <div style="background:rgba(16,185,129,0.1); padding:20px; border-radius:15px; text-align:center;">
                <span style="color:#94a3b8">کۆی پارە</span><br><b id="totalMoney" style="font-size:25px; color:var(--success)">0</b>
            </div>
        </div>
    </div>

    <div id="settings-tab" class="admin-box">
        <h2>System Settings</h2>
        <div class="form-group">
            <label>ئاگاداری ناو سایت</label>
            <textarea id="admAlert" rows="2"></textarea>
        </div>
        <div class="form-grid">
            <div class="form-group"><label>حمولەی گشتی (0.99)</label><input type="number" id="admFee" step="0.01"></div>
            <div class="form-group"><label>حمولەی کۆڕەک (0.82)</label><input type="number" id="korekFee" step="0.01"></div>
            <div class="form-group"><label>ڤێرژنی ئەپ (نموونە v5.3)</label><input type="text" id="admVersion"></div>
            <div class="form-group"><label>لینکی تێلێگرام</label><input type="text" id="teleLink"></div>
        </div>
        <button class="btn" onclick="saveSettings()">Save & Publish</button>
    </div>

    <div id="wallets-tab" class="admin-box">
        <h2>Manage Receiving Wallets</h2>
        <div class="form-grid">
            <div class="form-group"><label>FastPay / FIB Number</label><input type="text" id="walletMain"></div>
            <div class="form-group"><label>QiCard Number</label><input type="text" id="walletQi"></div>
            <div class="form-group"><label>USDT (TRC20)</label><input type="text" id="walletUsdt"></div>
        </div>
        <button class="btn" onclick="saveWallets()">Update Wallets</button>
    </div>

    <div id="orders-tab" class="admin-box">
        <h2>Recent Orders</h2>
        <div id="ordersList"></div>
    </div>
</div>

<div id="fullImgModal" onclick="this.style.display='none'"><img id="imgView"></div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyB056_g2Y3AJjtjG9715FgtXIhtjFcMPPU", authDomain: "zana-exchange.firebaseapp.com", databaseURL: "https://zana-exchange-default-rtdb.firebaseio.com", projectId: "zana-exchange" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function checkPass() {
        if(document.getElementById('passInput').value === "zana123") {
            document.getElementById('login-overlay').style.display = 'none';
            initAdmin();
        } else { alert("Password Wrong!"); }
    }

    function openTab(tabId, btn) {
        document.querySelectorAll('.admin-box').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        btn.classList.add('active');
    }

    function initAdmin() {
        // Load Settings
        db.ref('settings').on('value', s => {
            const d = s.val();
            if(d) {
                document.getElementById('admAlert').value = d.alertMsg;
                document.getElementById('admFee').value = d.fee;
                document.getElementById('korekFee').value = d.korekFee || 0.82;
                document.getElementById('admVersion').value = d.version || "v5.2";
                document.getElementById('teleLink').value = d.teleLink || "t.me/zana_exchange";
                document.getElementById('walletMain').value = d.wallet || "07510074008";
                document.getElementById('walletQi').value = d.walletQi || "07758887488";
                document.getElementById('walletUsdt').value = d.walletUsdt || "TTaNnxWNt2bjgSvpRY7NpvyCHUXDi6wjYc";
            }
        });

        // Load Orders
        db.ref('orders').on('value', snap => {
            const data = snap.val();
            let html = ""; let count = 0; let money = 0;
            if(data) {
                Object.values(data).reverse().forEach(o => {
                    count++; money += parseInt(o.amt) || 0;
                    html += `
                    <div class="order-card">
                        <div>
                            <b>#${o.orderID}</b> - ${o.total}<br>
                            <small>${o.from} ➔ ${o.to}</small><br>
                            <button class="btn" style="width:auto; padding:5px 10px; background:var(--success)" onclick="updateStatus('${o.orderID}','accepted')">Done</button>
                            <button class="btn" style="width:auto; padding:5px 10px; background:var(--danger)" onclick="updateStatus('${o.orderID}','rejected')">X</button>
                        </div>
                        <img src="${o.image || 'https://via.placeholder.com/60'}" class="receipt-img" onclick="showImg(this.src)">
                    </div>`;
                });
            }
            document.getElementById('ordersList').innerHTML = html;
            document.getElementById('todayOrders').innerText = count;
            document.getElementById('totalMoney').innerText = money.toLocaleString() + " IQD";
        });
    }

    async function saveSettings() {
        await db.ref('settings').update({
            alertMsg: document.getElementById('admAlert').value,
            fee: document.getElementById('admFee').value,
            korekFee: document.getElementById('korekFee').value,
            version: document.getElementById('admVersion').value,
            teleLink: document.getElementById('teleLink').value
        });
        alert("سیستم نوێکرایەوە!");
    }

    async function saveWallets() {
        await db.ref('settings').update({
            wallet: document.getElementById('walletMain').value,
            walletQi: document.getElementById('walletQi').value,
            walletUsdt: document.getElementById('walletUsdt').value
        });
        alert("واڵێتەکان نوێکرانەوە!");
    }

    function showImg(src) {
        document.getElementById('imgView').src = src;
        document.getElementById('fullImgModal').style.display = 'flex';
    }

    function updateStatus(id, s) { db.ref('orders/' + id).update({ status: s }); }
</script>
</body>
</html>
