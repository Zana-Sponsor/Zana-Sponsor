<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zana Pro Admin | Control Center</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --main: #facc15; --bg: #0f172a; --card: #1e293b; --success: #10b981; --danger: #ef4444; --border: #334155; }
        body { font-family: 'Tahoma', sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; text-align: right; }
        .container { max-width: 900px; margin: auto; display: none; }
        #login-screen { position: fixed; inset: 0; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 10000; }
        .login-box { background: var(--card); padding: 30px; border-radius: 25px; border: 1px solid var(--border); width: 320px; text-align: center; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
        .tab-btn { background: #1e293b; color: #94a3b8; border: 1px solid var(--border); padding: 12px 25px; border-radius: 15px; cursor: pointer; white-space: nowrap; font-weight: bold; }
        .tab-btn.active { background: var(--main); color: #000; }
        .admin-box { background: var(--card); padding: 25px; border-radius: 25px; border: 1px solid var(--border); display: none; }
        .admin-box.active { display: block; }
        input, select { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid var(--border); background: #0f172a; color: white; margin-bottom: 15px; box-sizing: border-box; }
        .btn-main { background: var(--main); color: #000; border: none; padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; width: 100%; font-size: 16px; }
        .list-row { background: #0f172a; padding: 15px; margin-bottom: 10px; border-radius: 15px; border: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-box">
        <i class="fas fa-lock" style="font-size: 40px; color: var(--main); margin-bottom: 20px;"></i>
        <h2>چوونەژوورەوە</h2>
        <input type="password" id="adminPass" placeholder="وشەی نهێنی...">
        <button class="btn-main" onclick="checkAuth()">Login</button>
    </div>
</div>

<div class="container" id="mainUI">
    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('orders-tab', this)">ئۆردەرەکان</button>
        <button class="tab-btn" onclick="openTab('wallets-tab', this)">واڵێت و حمولە</button>
    </div>

    <div id="orders-tab" class="admin-box active">
        <div id="ordersList"></div>
    </div>

    <div id="wallets-tab" class="admin-box">
        <h3>زیادکردنی دراو و حمولە</h3>
        <input type="text" id="wName" placeholder="ناوی دراو (وەک: FastPay)">
        <input type="text" id="wNum" placeholder="ژمارەی وەرگرتن">
        <input type="number" id="wFee" step="0.01" value="0.95" placeholder="حمولە (0.95)">
        <select id="wType">
            <option value="both">Both</option>
            <option value="from">From</option>
            <option value="to">To</option>
        </select>
        <button class="btn-main" onclick="addMethod()">پاشەکەوتکردن</button>
        <hr style="border: 1px solid var(--border); margin: 20px 0;">
        <div id="methodsList"></div>
    </div>
</div>

<script>
    const firebaseConfig = { 
        apiKey: "AIzaSyB056_g2Y3AJjtjG9715FgtXIhtjFcMPPU", 
        authDomain: "zana-exchange.firebaseapp.com", 
        databaseURL: "https://zana-exchange-default-rtdb.firebaseio.com", 
        projectId: "zana-exchange" 
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // پاسۆرد: zana2024
    function checkAuth() {
        if(document.getElementById('adminPass').value === "zana2024") {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('mainUI').style.display = 'block';
            loadData();
        } else { alert("هەڵەیە!"); }
    }

    function openTab(id, btn) {
        document.querySelectorAll('.admin-box').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
    }

    function addMethod() {
        const name = document.getElementById('wName').value;
        const val = document.getElementById('wNum').value;
        const fee = document.getElementById('wFee').value;
        const type = document.getElementById('wType').value;

        if(name && fee) {
            // تێبینی: لێرە ڕاستەوخۆ دەینێرین بۆ 'methods'
            db.ref('methods').push({
                name: name,
                value: val || "---",
                fee: parseFloat(fee),
                type: type
            }).then(() => {
                alert("بە سەرکەوتوویی زیاد بوو!");
                document.getElementById('wName').value = "";
                document.getElementById('wNum').value = "";
            }).catch(e => alert("هەڵە: " + e.message));
        } else {
            alert("تکایە خانەکان پڕ بکەرەوە!");
        }
    }

    function loadData() {
        // خوێندنەوەی واڵێتەکان
        db.ref('methods').on('value', s => {
            let h = ""; const d = s.val();
            if(d) Object.keys(d).forEach(k => {
                h += `<div class="list-row">
                    <div><b>${d[k].name}</b> (${d[k].type})<br><small>${d[k].value}</small></div>
                    <button onclick="db.ref('methods/${k}').remove()" style="color:var(--danger); background:none; border:none; cursor:pointer; font-size:20px;">&times;</button>
                </div>`;
            });
            document.getElementById('methodsList').innerHTML = h;
        });

        // خوێندنەوەی ئۆردەرەکان
        db.ref('orders').on('value', snap => {
            let html = ""; const data = snap.val();
            if(data) Object.values(data).reverse().forEach(o => {
                html += `<div style="background:#161e2d; padding:15px; border-radius:15px; margin-bottom:10px; border-right:5px solid var(--main);">
                    <b>#${o.orderID}</b> - ${o.amt} ${o.from} ➔ ${o.total} ${o.to}
                </div>`;
            });
            document.getElementById('ordersList').innerHTML = html;
        });
    }
</script>
</body>
</html>
