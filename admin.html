<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ZANA ADMIN PRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');
        body { font-family: 'Vazirmatn', Tahoma; background: #0a0a0c; color: white; padding: 20px; direction: rtl; }
        .box { background: #16161a; padding: 20px; border-radius: 15px; border: 1px solid #2d2d35; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        input, textarea { width: 100%; padding: 12px; background: #1f1f24; border: 1px solid #2d2d35; color: white; border-radius: 8px; margin-bottom: 10px; box-sizing: border-box; }
        button { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-blue { background: #00d2ff; color: #000; }
        .btn-red { background: #ff4d4d; color: #fff; }
        .btn-green { background: #2ecc71; color: #fff; }
        
        .card { background: #1f1f24; padding: 15px; border-radius: 12px; margin-bottom: 10px; border-right: 4px solid #00d2ff; }
        .user-card { border-right-color: #f1c40f; display: flex; justify-content: space-between; align-items: center; }
        .badge { font-size: 11px; padding: 4px 8px; border-radius: 5px; margin-right: 5px; }
        .bg-wait { background: #f1c40f; color: #000; }
    </style>
</head>
<body>
    <h2><i class="fas fa-user-shield"></i> Ú©Û†Ù†ØªÚ•Û†Úµ Ù¾Ø§Ù†ÛÚµÛŒ Ø²Ø§Ù†Ø§</h2>

    <div class="grid">
        <div>
            <div class="box">
                <h3>Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±ÛŒ Ø³Û•Ø±Û•ÙˆÛ•</h3>
                <input type="text" id="alertTxt" placeholder="Ø¯Û•Ù‚ÛŒ Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±ÛŒ...">
                <button class="btn-blue" onclick="setAlert(true)">Ø¨ÚµØ§ÙˆÚ©Ø±Ø¯Ù†Û•ÙˆÛ•</button>
                <button class="btn-red" onclick="setAlert(false)">Ù„Ø§Ø¨Ø±Ø¯Ù†</button>
            </div>
            <div class="box">
                <h3>Ú•Ø§Ú¯Ø±ØªÙ†ÛŒ Ø¦Û•Ù¾</h3>
                <textarea id="lockMsg" placeholder="Ù†Ø§Ù…Û•ÛŒ Ù‚ÙˆÙÚµÚ©Ø±Ø¯Ù†..."></textarea>
                <button class="btn-red" onclick="setLock(true)">ğŸ”´ Lock</button>
                <button class="btn-blue" onclick="setLock(false)">ğŸŸ¢ Unlock</button>
            </div>
        </div>

        <div class="box">
            <h3><i class="fas fa-users"></i> Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±Ø§Ù†</h3>
            <div id="userList" style="max-height: 400px; overflow-y: auto;"></div>
        </div>
    </div>

    <div class="box">
        <h3><i class="fas fa-exchange-alt"></i> Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†</h3>
        <div id="adminOrders"></div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyB056_g2Y3AJjtjG9715FgtXIhtjFcMPPU", databaseURL: "https://zana-exchange-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- Alerts & Locks ---
        function setAlert(st) { db.ref('alertMsg').set({ text: document.getElementById('alertTxt').value, show: st }); alert("Ø¦Û•Ù†Ø¬Ø§Ù…Ø¯Ø±Ø§!"); }
        function setLock(st) { db.ref('appStatus').set({ locked: st, message: document.getElementById('lockMsg').value }); alert("Ú¯Û†Ú•Ø¯Ø±Ø§!"); }

        // --- Manage Orders (Accept, Reject, Delete) ---
        db.ref('orders').on('value', snap => {
            let html = "";
            snap.forEach(c => {
                const o = c.val();
                html += `
                <div class="card">
                    <div style="display:flex; justify-content:space-between">
                        <b>ID: ${c.key} | Ú©Ú•ÛŒØ§Ø±: ${o.uName}</b>
                        <span class="badge bg-wait">${o.status}</span>
                    </div>
                    <p style="font-size:13px; color:#aaa;">${o.from} â¬…ï¸ ${o.to} | Ø¨Ú•: ${o.total} | Ú˜Ù…Ø§Ø±Û•: ${o.userPhone}</p>
                    <button class="btn-green" onclick="updateOrder('${c.key}', 'ÙˆÛ•Ø±Ú¯ÛŒØ±Ø§')">Ù‚Ø¨ÙˆÚµ</button>
                    <button class="btn-red" onclick="updateOrder('${c.key}', 'Ú•Û•ØªÚ©Ø±Ø§ÛŒÛ•ÙˆÛ•')">Ú•Û•ØªÚ©Ø±Ø¯Ù†Û•ÙˆÛ•</button>
                    <button style="background:#555; color:white;" onclick="deleteOrder('${c.key}')">Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button>
                </div>`;
            });
            document.getElementById('adminOrders').innerHTML = html || "Ù‡ÛŒÚ† Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú© Ù†ÛŒÛŒÛ•";
        });

        function updateOrder(id, status) { db.ref('orders/' + id).update({ status: status }); }
        function deleteOrder(id) { if(confirm("Ø¯ÚµÙ†ÛŒØ§ÛŒ Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ØŸ")) db.ref('orders/' + id).remove(); }

        // --- Monitor & Block Users ---
        db.ref('users').on('value', snap => {
            let html = "";
            snap.forEach(c => {
                const u = c.val();
                const isBlocked = u.isBlocked || false;
                html += `
                <div class="card user-card">
                    <div>
                        <b>${u.name || 'Ø¨Û Ù†Ø§Ùˆ'}</b><br>
                        <small style="color:#888">${isBlocked ? 'ğŸš« Ø¨Ù„Û†Ú© Ú©Ø±Ø§ÙˆÛ•' : 'âœ… Ú†Ø§Ù„Ø§Ú©Û•'}</small>
                    </div>
                    <button class="${isBlocked ? 'btn-blue' : 'btn-red'}" onclick="toggleBlock('${c.key}', ${isBlocked})">
                        ${isBlocked ? 'Ù„Ø§Ø¨Ø±Ø¯Ù†ÛŒ Ø¨Ù„Û†Ú©' : 'Ø¨Ù„Û†Ú©Ú©Ø±Ø¯Ù†'}
                    </button>
                </div>`;
            });
            document.getElementById('userList').innerHTML = html;
        });

        function toggleBlock(uid, currentStatus) {
            db.ref('users/' + uid).update({ isBlocked: !currentStatus });
        }
    </script>
</body>
</html>
