<script>
    const supabaseClient = supabase.createClient('https://rtbsblgaewmfiynhwgkv.supabase.co', 'EyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ0YnNibGdhZXdtZml5bmh3Z2t2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzODIwNDcsImV4cCI6MjA4Njk1ODA0N30.-aEC48G8Hltu6N8y2nPhAYPdB-4PSsR78OSXSLMAGcU');

    document.getElementById('fbForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        const msgText = document.getElementById('msg');
        btn.disabled = true;
        btn.innerText = 'چاوەڕوانبە...';

        const nameValue = document.getElementById('custName').value;
        const commentValue = document.getElementById('custMsg').value;

        // ناردنی داتا بۆ خشتەی feedback
        const { error } = await supabaseClient
            .from('feedback')
            .insert([{ 
                name: nameValue, 
                comment: commentValue, 
                is_approved: false 
            }]);

        if (error) {
            // لێرە ڕێک هەڵەکەمان بۆ دەردەخات
            console.error("Supabase Error:", error);
            msgText.innerText = "هەڵە: " + error.message + " (کۆد: " + error.code + ")";
            msgText.style.color = "red";
        } else {
            msgText.innerText = "سوپاس! فیدباکەکەت ناردرا.";
            msgText.style.color = "green";
            document.getElementById('fbForm').reset();
        }
        msgText.style.display = "block";
        btn.disabled = false;
        btn.innerText = 'ناردنی فیدباک';
    });
</script>
