<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zana Exchange | Pro Cloud</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --main: #facc15; --bg: #0f172a; --card: #1e293b; --success: #10b981; --danger: #ef4444; --gold: linear-gradient(135deg, #facc15 0%, #eab308 100%); }
        body { font-family: 'Tahoma', sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; text-align: right; }
        .container { max-width: 400px; margin: auto; }
        .card { background: var(--card); padding: 25px; border-radius: 25px; border: 1px solid #334155; box-shadow: 0 15px 35px rgba(0,0,0,0.5); position: relative; }
        .logo-title { font-size: 20px; font-weight: 900; background: var(--gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; display: block; text-align: center; margin-bottom: 20px; }
        .version-badge { display: inline-block; background: rgba(250, 204, 21, 0.1); color: var(--main); font-size: 10px; padding: 2px 8px; border-radius: 20px; border: 1px solid var(--main); cursor: pointer; }
        .group { margin-bottom: 15px; }
        label { display: block; font-size: 12px; color: #94a3b8; margin-bottom: 5px; }
        input { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #334155; background: #0f172a; color: white; outline: none; box-sizing: border-box; }
        .btn { background: var(--gold); color: #000; border: none; width: 100%; padding: 15px; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .admin-section { display: none; margin-top: 25px; border-top: 2px dashed #444; padding-top: 20px; }
        .hist-item { background: #0f172a; padding: 15px; border-radius: 15px; margin-top: 10px; border-right: 5px solid var(--main); position: relative; }
        .status-badge { font-size: 10px; padding: 3px 8px; border-radius: 6px; float: left; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <span class="logo-title">ZANA EXCHANGE PRO</span>
        <div style="text-align: center;">
            <span class="version-badge" onclick="openAdmin()">Ú¤ÛŽØ±Ú˜Ù† 2.9.0 (Admin Mode)</span>
        </div>

        <div id="userSide">
            <div class="group">
                <label>Ø¨Ú•ÛŒ Ù†Ø§Ø±Ø¯Ù† (Amount IQD)</label>
                <input type="number" id="amt" placeholder="100,000">
            </div>
            <div class="group">
                <label>Ú˜Ù…Ø§Ø±Û•ÛŒ ÙˆÛ•Ø±Ú¯Ø± (Receiver Phone)</label>
                <input type="text" id="phone" placeholder="07XXXXXXXXX">
            </div>
            <button class="btn" onclick="sendOrder()">Ù†Ø§Ø±Ø¯Ù†ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ</button>
        </div>

        <div id="adminSide" class="admin-section">
            <h3 style="text-align:center; color:var(--main);">ðŸ›  Ø¨Û•Ú•ÛŽÙˆÛ•Ø¨Ø±Ø¯Ù†</h3>
            <input type="number" id="targetID" placeholder="ID Ø¦Û†Ø±Ø¯Û•Ø± Ø¨Ù†ÙˆÙˆØ³Û•" style="text-align:center; font-size:20px;">
            <div style="display: flex; gap: 10px;">
                <button class="btn" style="background:var(--success)" onclick="updateStatus('accepted')">Ù‚Ø¨ÙˆÚµ (Accept)</button>
                <button class="btn" style="background:var(--danger)" onclick="updateStatus('rejected')">Ú•Û•Øª (Reject)</button>
            </div>
            <button class="btn" style="background:#475569; color:white;" onclick="location.reload()">Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ•</button>
        </div>
    </div>

    <div style="margin-top: 25px;">
        <h4 style="color:var(--main); margin-bottom:10px;">ðŸ•’ Ø¯ÙˆØ§ÛŒÛŒÙ† Ø¦Û†Ø±Ø¯Û•Ø±Û•Ú©Ø§Ù†:</h4>
        <div id="orderList">Ø¨Ø§Ø±Ø¯Û•Ú©Ø±ÛŽØª...</div>
    </div>
</div>

<script>
    // --- âš ï¸ Ù„ÛŽØ±Û• Ø²Ø§Ù†ÛŒØ§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†Øª Ù¾Ú• Ø¨Ú©Û•Ø±Û•ÙˆÛ• ---
    const GH_TOKEN = "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"; 
    const GH_REPO = "Username/RepoName"; // Ù„ÛŽØ±Û• Ø¨Ù†ÙˆÙˆØ³Û•: Username/RepoName
    const GH_FILE = "orders.json";

    function openAdmin() {
        if(prompt("Ù¾Ø§Ø³ÙˆÛ†Ø±Ø¯ Ø¨Ù†ÙˆÙˆØ³Û•:") === "1234") {
            document.getElementById('userSide').style.display = 'none';
            document.getElementById('adminSide').style.display = 'block';
        }
    }

    // ÙˆÛ•Ø±Ú¯Ø±ØªÙ†ÛŒ Ø¯Ø§ØªØ§ Ù„Û• Ú¯ÛŽØª Ù‡Û•Ø¨
    async function getFromGH() {
        const url = `https://api.github.com/repos/${GH_REPO}/contents/${GH_FILE}`;
        const res = await fetch(url, { headers: { 'Authorization': `token ${GH_TOKEN}` } });
        const data = await res.json();
        return { content: JSON.parse(decodeURIComponent(escape(atob(data.content)))), sha: data.sha };
    }

    // Ù¾Ø§Ø´Û•Ú©Û•ÙˆØªÚ©Ø±Ø¯Ù† Ù„Û• Ú¯ÛŽØª Ù‡Û•Ø¨
    async function saveToGH(newContent, sha, msg) {
        const url = `https://api.github.com/repos/${GH_REPO}/contents/${GH_FILE}`;
        await fetch(url, {
            method: 'PUT',
            headers: { 'Authorization': `token ${GH_TOKEN}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({
                message: msg,
                content: btoa(unescape(encodeURIComponent(JSON.stringify(newContent, null, 2)))),
                sha: sha
            })
        });
    }

    // Ù†Ø§Ø±Ø¯Ù†ÛŒ Ø¦Û†Ø±Ø¯Û•Ø±ÛŒ Ù†ÙˆÛŽ
    async function sendOrder() {
        const amt = document.getElementById('amt').value;
        const phone = document.getElementById('phone').value;
        if(!amt || !phone) return alert("ØªÚ©Ø§ÛŒÛ• Ø®Ø§Ù†Û•Ú©Ø§Ù† Ù¾Ú• Ø¨Ú©Û•Ø±Û•ÙˆÛ•");

        const id = Math.floor(10000 + Math.random() * 90000);
        try {
            const { content, sha } = await getFromGH();
            content.unshift({ id, amt, phone, status: 'pending', time: new Date().toLocaleString('ku-IQ') });
            await saveToGH(content, sha, `New Order #${id}`);
            alert("Ø¦Û†Ø±Ø¯Û•Ø± Ù†ÛŽØ±Ø¯Ø±Ø§! Ú©Û†Ø¯ÛŒ ØªÛ†: " + id);
            location.reload();
        } catch(e) { alert("Ù‡Û•ÚµÛ•! Ø¯ÚµÙ†ÛŒØ§Ø¨Û•Ø±Û•ÙˆÛ• Ù„Û• Ø²Ø§Ù†ÛŒØ§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†ÛŒ Ú¯ÛŽØª Ù‡Û•Ø¨"); }
    }

    // Ù‚Ø¨ÙˆÚµÚ©Ø±Ø¯Ù† ÛŒØ§Ù† Ú•Û•ØªÚ©Ø±Ø¯Ù†Û•ÙˆÛ•
    async function updateStatus(status) {
        const id = parseInt(document.getElementById('targetID').value);
        let reason = "";
        if(status === 'rejected') reason = prompt("Ù‡Û†Ú©Ø§Ø±ÛŒ Ú•Û•ØªÚ©Ø±Ø¯Ù†Û•ÙˆÛ•:") || "Ø²Ø§Ù†ÛŒØ§Ø±ÛŒ Ù‡Û•ÚµÛ•ÛŒÛ•";

        try {
            const { content, sha } = await getFromGH();
            const idx = content.findIndex(o => o.id === id);
            if(idx !== -1) {
                content[idx].status = status;
                if(reason) content[idx].reason = reason;
                await saveToGH(content, sha, `Update Order #${id} to ${status}`);
                alert("Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ Ø¨ÙˆÙˆ!");
                location.reload();
            } else { alert("Ú©Û†Ø¯Û•Ú©Û• Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•!"); }
        } catch(e) { alert("Ù‡Û•ÚµÛ• Ú•ÙˆÙˆÛŒØ¯Ø§!"); }
    }

    // Ù†ÛŒØ´Ø§Ù†Ø¯Ø§Ù†ÛŒ Ù„ÛŒØ³ØªÛ•Ú©Û•
    async function loadHistory() {
        try {
            const { content } = await getFromGH();
            document.getElementById('orderList').innerHTML = content.slice(0, 10).map(o => `
                <div class="hist-item" style="border-right-color: ${o.status==='accepted'?'var(--success)':o.status==='rejected'?'var(--danger)':'var(--main)'}">
                    <span class="status-badge" style="background:${o.status==='accepted'?'#10b981':o.status==='rejected'?'#ef4444':'#facc15'}">
                        ${o.status === 'pending' ? 'Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†' : o.status === 'accepted' ? 'Ù†ÛŽØ±Ø¯Ø±Ø§' : 'Ú•Û•ØªÚ©Ø±Ø§ÛŒÛ•ÙˆÛ•'}
                    </span>
                    <b>#${o.id}</b><br>
                    Ø¨Ú•: ${o.amt} IQD | ${o.phone}<br>
                    ${o.reason ? `<small style="color:var(--danger)">Ù‡Û†Ú©Ø§Ø±: ${o.reason}</small><br>` : ''}
                    <small style="opacity:0.5">${o.time}</small>
                </div>
            `).join('');
        } catch(e) { document.getElementById('orderList').innerText = "Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†ÛŒÛŒÛ• ÛŒØ§Ù† Ú©Û†Ù†ÛŽÚ©Øª Ù†Û•Ø¨ÙˆÙˆÛ•."; }
    }

    window.onload = loadHistory;
</script>
</body>
</html>
