<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zana Exchange | Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --main: #facc15; --bg: #0f172a; --card: #1e293b; --success: #10b981; --danger: #ef4444; --gold: linear-gradient(135deg, #facc15 0%, #eab308 100%); --telegram: #0088cc; }
        body { font-family: 'Tahoma', sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; text-align: right; }
        
        /* ğŸ¨ Ø³ØªØ§ÛŒÙ„ÛŒ Ø´Ø§Ø´Û•ÛŒ Ù„Û†Ú¯ÛŒÙ† */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(15px);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 9999; transition: 0.5s;
        }
        .google-card {
            background: var(--card); padding: 40px 20px; border-radius: 30px;
            border: 1px solid rgba(250, 204, 21, 0.2); text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); width: 85%; max-width: 350px;
        }
        .google-btn {
            background: white; color: #1e293b; border: none; padding: 14px 20px;
            border-radius: 15px; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 12px;
            width: 100%; font-size: 15px; margin-top: 20px;
        }

        /* ğŸ‘¤ Ù¾Ú•Û†ÙØ§ÛŒÙ„ÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø± */
        .user-bar {
            display: flex; align-items: center; justify-content: space-between;
            background: var(--card); padding: 10px 15px; border-radius: 20px;
            margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.05);
        }
        .profile-info { display: flex; align-items: center; gap: 10px; }
        .profile-img { width: 38px; height: 38px; border-radius: 50%; border: 2px solid var(--main); }
        
        /* ğŸ“¦ Ø³ØªØ§ÛŒÙ„ÛŒ Ø²Ø§Ù†ÛŒØ§Ø±ÛŒÛŒÛ•Ú©Ø§Ù† Ùˆ Ø¯ÙˆÚ¯Ù…Û•Ú©Ø§Ù† */
        .info-row { display: flex; justify-content: space-between; margin-top: 10px; font-size: 12px; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 8px; }
        .action-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .btn-action { padding: 10px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; font-size: 12px; }
        
        .container { max-width: 400px; margin: auto; display: none; }
        .card { background: var(--card); padding: 20px; border-radius: 25px; border: 1px solid #334155; margin-bottom: 20px; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="google-card">
        <i class="fas fa-user-lock" style="font-size: 50px; color: var(--main); margin-bottom: 15px;"></i>
        <h2 style="margin: 0;">ZANA EXCHANGE</h2>
        <p style="color: #94a3b8; font-size: 13px;">ØªÚ©Ø§ÛŒÛ• Ø¨Û• Gmail Ø¯Ø§Ø®Ù„ Ø¨Ø¨Û• Ø¨Û† Ø¨Û•Ø±Ø¯Û•ÙˆØ§Ù…Ø¨ÙˆÙˆÙ†</p>
        <button class="google-btn" onclick="signIn()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
            Ø¨Û•Ø±Ø¯Û•ÙˆØ§Ù…Ø¨Û• Ø¨Û• Google
        </button>
    </div>
</div>

<div class="container" id="mainContent">
    <div class="user-bar">
        <div class="profile-info">
            <img id="userImg" src="" class="profile-img">
            <div>
                <div id="userName" style="font-size: 12px; font-weight: bold;">...</div>
                <div style="font-size: 9px; color: var(--success);">Ú†Ø§Ù„Ø§Ú©Û•</div>
            </div>
        </div>
        <i class="fas fa-sign-out-alt" style="color:var(--danger); cursor:pointer;" onclick="signOutUser()"></i>
    </div>

    <div class="card" style="text-align: center;">
        <div style="font-size: 11px; color: #94a3b8;">Ú©Û†ÛŒ ÙØ±Û†Ø´ØªÙ†ÛŒ Ø¦Û•Ù…Ú•Û†</div>
        <div id="todaySales" style="font-size: 24px; font-weight: bold; color: var(--main);">0 IQD</div>
        <div style="font-size: 10px; margin-top: 5px;">Ú©Û†ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†: <span id="totalOrdersCount">0</span></div>
    </div>

    <div id="ordersList"></div>
</div>

<script>
    const firebaseConfig = { 
        apiKey: "AIzaSyB056_g2Y3AJjtjG9715FgtXIhtjFcMPPU", 
        authDomain: "zana-exchange.firebaseapp.com", 
        databaseURL: "https://zana-exchange-default-rtdb.firebaseio.com", 
        projectId: "zana-exchange" 
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    // ğŸ”‘ Auth Functions
    function signIn() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).catch(e => alert(e.message));
    }

    function signOutUser() {
        if(confirm("Ø¯Û•ØªÛ•ÙˆÛØª Ø¨Ú†ÛŒØªÛ• Ø¯Û•Ø±Û•ÙˆÛ•ØŸ")) auth.signOut();
    }

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('userName').innerText = user.displayName;
            document.getElementById('userImg').src = user.photoURL;
        } else {
            document.getElementById('loginOverlay').style.display = 'flex';
            document.getElementById('mainContent').style.display = 'none';
        }
    });

    // ğŸ”„ Ú©Û†Ø¯ÛŒ Ù†ÛŒØ´Ø§Ù†Ø¯Ø§Ù†ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù† Ùˆ Ø¯ÙˆÚ¯Ù…Û•Ú©Ø§Ù†
    db.ref('orders').on('value', (snap) => {
        let ordersHtml = "";
        let totalSales = 0;
        let count = 0;

        snap.forEach((child) => {
            const o = child.val();
            count++;
            if(o.status === 'accepted') {
                let cleanAmt = String(o.amt).replace(/[^0-9]/g, '');
                totalSales += parseInt(cleanAmt) || 0;
            }

            let statusColor = o.status === 'accepted' ? 'var(--success)' : (o.status === 'rejected' ? 'var(--danger)' : 'var(--main)');
            
            ordersHtml += `
            <div class="card" style="border-right: 5px solid ${statusColor}">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <b style="color:var(--main)">#${o.orderID}</b>
                    <span style="font-size:11px; color:${statusColor}">${o.status}</span>
                </div>
                
                <div class="info-row">
                    <div><i class="fas fa-phone-alt"></i> Ù†ÛØ±Û•Ø±: <b>${o.senderPh}</b></div>
                    <div><i class="fas fa-user-check"></i> ÙˆÛ•Ø±Ú¯Ø±: <b>${o.userPh}</b></div>
                </div>
                
                <div class="info-row">
                    <div><i class="fas fa-money-bill"></i> Ø¨Ú•: <b>${o.amt}</b></div>
                    <div><i class="fas fa-clock"></i> Ú©Ø§Øª: <b>${o.time}</b></div>
                </div>

                <div class="action-btns">
                    <button class="btn-action" style="background:var(--success); color:white;" onclick="updateStatus('${child.key}', 'accepted')">Ù‚Ø¨ÙˆÚµÚ©Ø±Ø¯Ù†</button>
                    <button class="btn-action" style="background:var(--danger); color:white;" onclick="updateStatus('${child.key}', 'rejected')">Ú•Û•ØªÚ©Ø±Ø¯Ù†Û•ÙˆÛ•</button>
                </div>
            </div>`;
        });
        
        document.getElementById('ordersList').innerHTML = ordersHtml;
        document.getElementById('todaySales').innerText = totalSales.toLocaleString() + " IQD";
        document.getElementById('totalOrdersCount').innerText = count;
    });

    function updateStatus(id, status) {
        db.ref('orders/' + id).update({ status: status });
    }
</script>

</body>
</html>
