<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>ZANA EXCHANGE | Pro Login</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;500;800&display=swap');
        :root { --accent: #00d2ff; --bg: #0d1117; --card: #161b22; --border: #30363d; --text: #ffffff; --danger: #ff4d4d; --success: #2ecc71; }
        
        body { font-family: 'Vazirmatn', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; min-height: 100vh; overflow-x: hidden; }
        
        /* âœ¨ Ø³ØªØ§ÛŒÙ„ÛŒ Ù…Û†Ø¯ÛŽØ±Ù†ÛŒ Ù„Û†Ú¯ÛŒÙ† */
        #loginSection { background: radial-gradient(circle at top right, #1e293b, #0d1117); width: 100%; height: 100vh; display: flex; justify-content: center; align-items: center; position: fixed; z-index: 10000; }
        .login-card { background: rgba(22, 27, 34, 0.9); backdrop-filter: blur(15px); padding: 35px 25px; border-radius: 30px; border: 1px solid var(--border); text-align: center; width: 88%; max-width: 380px; box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
        .login-logo { width: 70px; height: 70px; background: var(--accent); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 30px; color: #000; box-shadow: 0 10px 20px rgba(0, 210, 255, 0.2); }
        
        .tab-box { display: flex; background: #000; border-radius: 12px; padding: 5px; margin-bottom: 25px; border: 1px solid var(--border); }
        .tab-btn { flex: 1; background: none; border: none; color: #fff; padding: 10px; cursor: pointer; border-radius: 8px; font-family: 'Vazirmatn'; transition: 0.3s; opacity: 0.5; }
        .tab-active { background: var(--accent); color: #000; opacity: 1; font-weight: 800; }

        input { width: 100%; background: #21262d; border: 1px solid var(--border); border-radius: 15px; padding: 15px; color: #fff; margin-bottom: 12px; font-family: 'Vazirmatn'; outline: none; box-sizing: border-box; transition: 0.3s; }
        input:focus { border-color: var(--accent); background: #2d333b; }
        
        .btn-main { background: var(--accent); color: #000; width: 100%; padding: 16px; border: none; border-radius: 15px; font-weight: 800; cursor: pointer; font-size: 16px; margin-top: 10px; transition: 0.3s; }
        .btn-main:active { transform: scale(0.98); }

        /* ðŸ“± Ø³ØªØ§ÛŒÙ„ÛŒ Ø¦Û•Ù¾ÚµÛŒÚ©Û•ÛŒØ´Ù† */
        .app-wrapper { width: 100%; max-width: 450px; margin: 0 auto; padding: 15px; display: none; }
        .header { background: var(--card); padding: 15px; border-radius: 20px; border: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .user-box { display: flex; align-items: center; gap: 10px; }
        .circle-icon { width: 40px; height: 40px; background: #30363d; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--accent); }

        /* ðŸ§¾ History Design */
        .h-card { background: var(--card); border-radius: 20px; padding: 18px; margin-bottom: 15px; border: 1px solid var(--border); }
        .row { display: flex; justify-content: space-between; font-size: 13px; margin: 5px 0; }
    </style>
</head>
<body>

<div id="loginSection">
    <div class="login-card">
        <div class="login-logo"><i class="fas fa-bolt"></i></div>
        <h2 style="margin-bottom: 5px;">ZANA EXCHANGE</h2>
        <p style="font-size: 12px; opacity: 0.6; margin-bottom: 20px;">Ø®ÛŽØ±Ø§ØªØ±ÛŒÙ† Ùˆ Ø¨Ø§ÙˆÛ•Ú•Ù¾ÛŽÚ©Ø±Ø§ÙˆØªØ±ÛŒÙ† Ø³ÛŒØ³ØªÙ…</p>

        <div class="tab-box">
            <button id="lTab" class="tab-active tab-btn" onclick="toggleT('l')">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</button>
            <button id="rTab" class="tab-btn" onclick="toggleT('r')">Ù†Ø§ÙˆÙ†ÙˆÙˆØ³ÛŒÙ†</button>
        </div>

        <div id="lForm">
            <input type="email" id="lEmail" placeholder="Ø¦ÛŒÙ…ÛŽÚµ (@gmail.com)">
            <input type="password" id="lPass" placeholder="Ù¾Ø§Ø³Û†Ø±Ø¯">
            <button class="btn-main" onclick="doLogin()">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</button>
        </div>

        <div id="rForm" style="display:none;">
            <input type="text" id="rName" placeholder="Ù†Ø§ÙˆÛŒ ØªÛ•ÙˆØ§Ùˆ">
            <input type="email" id="rEmail" placeholder="Ø¦ÛŒÙ…ÛŽÚµ (@gmail.com)">
            <input type="password" id="rPass" placeholder="Ù¾Ø§Ø³Û†Ø±Ø¯ (Ù„Ø§Ù†ÛŒ Ú©Û•Ù… Ù¦ Ù¾ÛŒØª)">
            <button class="btn-main" onclick="doReg()">Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†ÛŒ Ø¦Û•Ú©Ø§ÙˆÙ†Øª</button>
        </div>
    </div>
</div>

<div class="app-wrapper" id="mainApp">
    <div class="header">
        <button onclick="logout()" style="background:none; border:none; color:var(--danger); font-size: 20px;"><i class="fas fa-power-off"></i></button>
        <div class="user-box">
            <span id="uName">...</span>
            <div class="circle-icon"><i class="fas fa-user"></i></div>
        </div>
    </div>

    <div style="background:var(--card); padding:20px; border-radius:25px; border:1px solid var(--border);">
        <select id="method" style="padding:15px; border-radius:15px;" onchange="updateW()">
            <option value="FastPay">FastPay</option>
            <option value="Asiacell">Asiacell (0.82)</option>
            <option value="Korek">Korek (0.80)</option>
        </select>
        <p style="text-align:center; font-size:12px;">Ø¨Ù†ÛŽØ±Û• Ø¨Û†: <b id="walletNum" style="color:var(--accent)">---</b></p>
        <input type="number" id="amount" placeholder="Ø¨Ú•ÛŒ Ù†Ø§Ø±Ø¯Ù†">
        <input type="tel" id="userWallet" placeholder="Ú˜Ù…Ø§Ø±Û•ÛŒ ÙˆØ§ÚµÛŽØªÛŒ ÙˆÛ•Ø±Ú¯Ø±ØªÙ†ÛŒ ØªÛ†">
        <button class="btn-main" onclick="sendOrder()">Ù†Ø§Ø±Ø¯Ù†ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ</button>
    </div>

    <h3 style="margin: 25px 10px 10px;">Ø¯ÙˆØ§ÛŒÛŒÙ† Ù…Ø§Ù…Û•ÚµÛ•Ú©Ø§Ù†</h3>
    <div id="hList"></div>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyB056_g2Y3AJjtjG9715FgtXIhtjFcMPPU", databaseURL: "https://zana-exchange-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth(); const db = firebase.database();

    function toggleT(t) {
        document.getElementById('lForm').style.display = t=='l'?'block':'none';
        document.getElementById('rForm').style.display = t=='r'?'block':'none';
        document.getElementById('lTab').className = t=='l'?'tab-btn tab-active':'tab-btn';
        document.getElementById('rTab').className = t=='r'?'tab-btn tab-active':'tab-btn';
    }

    // ðŸ“§ Ù¾Ø´Ú©Ù†ÛŒÙ†ÛŒ Ø¦ÛŒÙ…ÛŽÚµ ØªÛ•Ù†Ù‡Ø§ Ø¨Û† Gmail
    function isGmail(email) {
        return email.toLowerCase().endsWith('@gmail.com');
    }

    async function doReg() {
        const name = document.getElementById('rName').value;
        const email = document.getElementById('rEmail').value;
        const pass = document.getElementById('rPass').value;

        if(!name || !email || !pass) return alert("ØªÚ©Ø§ÛŒÛ• Ø®Ø§Ù†Û•Ú©Ø§Ù† Ù¾Ú•Ø¨Ú©Û•Ø±Û•ÙˆÛ•");
        if(!isGmail(email)) return alert("ØªÛ•Ù†Ù‡Ø§ Ø¦ÛŒÙ…ÛŽÚµÛŒ @gmail.com Ù‚Ø¨ÙˆÚµ Ø¯Û•Ú©Ø±ÛŽØª!");
        if(pass.length < 6) return alert("Ù¾Ø§Ø³Û†Ø±Ø¯ Ù†Ø§Ø¨ÛŽØª Ù„Û• Ù¦ Ù¾ÛŒØª Ú©Û•Ù…ØªØ± Ø¨ÛŽØª");

        try {
            const res = await auth.createUserWithEmailAndPassword(email, pass);
            await res.user.updateProfile({ displayName: name });
            await db.ref('users/' + res.user.uid).set({ name: name, email: email, isBlocked: false });
            alert("Ø¦Û•Ú©Ø§ÙˆÙ†Øª Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø§ âœ…");
        } catch (e) { alert("Ø¦Û•Ù… Ø¦ÛŒÙ…ÛŽÚµÛ• Ù¾ÛŽØ´ØªØ± Ø¨Û•Ú©Ø§Ø±Ù‡Ø§ØªÙˆÙˆÛ• ÛŒØ§Ù† Ù‡Û•ÚµÛ•ÛŒÛ•Ú© Ù‡Û•ÛŒÛ•"); }
    }

    async function doLogin() {
        const email = document.getElementById('lEmail').value;
        const pass = document.getElementById('lPass').value;
        if(!email || !pass) return alert("Ø¦ÛŒÙ…ÛŽÚµ Ùˆ Ù¾Ø§Ø³Û†Ø±Ø¯ Ø¨Ù†ÙˆÙˆØ³Û•");
        if(!isGmail(email)) return alert("ØªÛ•Ù†Ù‡Ø§ Ø¦ÛŒÙ…ÛŽÚµÛŒ @gmail.com Ù‚Ø¨ÙˆÚµ Ø¯Û•Ú©Ø±ÛŽØª!");

        try {
            await auth.signInWithEmailAndPassword(email, pass);
        } catch (e) { alert("Ø¦ÛŒÙ…ÛŽÚµ ÛŒØ§Ù† Ù¾Ø§Ø³Û†Ø±Ø¯ Ù‡Û•ÚµÛ•ÛŒÛ•!"); }
    }

    function logout() { auth.signOut().then(() => location.reload()); }

    auth.onAuthStateChanged(async (user) => {
        if (user) {
            const snap = await db.ref('users/' + user.uid).get();
            if (snap.exists() && snap.val().isBlocked) {
                alert("Ø¦Û•Ù… Ø¦Û•Ú©Ø§ÙˆÙ†ØªÛ• Ø¨Ù„Û†Ú© Ú©Ø±Ø§ÙˆÛ• ðŸš«"); auth.signOut(); return;
            }
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('uName').innerText = user.displayName;
            loadH(user.email);
            updateW();
        } else {
            document.getElementById('loginSection').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
        }
    });

    function loadH(email) {
        db.ref('orders').orderByChild('uEmail').equalTo(email).on('value', snap => {
            let h = "";
            snap.forEach(o => {
                const d = o.val();
                h = `<div class="h-card">
                    <div class="row"><span>ID: ${o.key}</span><b style="color:orange">${d.status}</b></div>
                    <div class="row"><span>Ø¨Ú•ÛŒ ÙˆÛ•Ø±Ú¯Ø±ØªÙ†:</span><b>${d.total}</b></div>
                    <div class="row"><small>${d.time}</small></div>
                </div>` + h;
            });
            document.getElementById('hList').innerHTML = h || "<p style='text-align:center; opacity:0.3;'>Ù…Ø§Ù…Û•ÚµÛ•Øª Ù†ÛŒÛŒÛ•</p>";
        });
    }

    async function sendOrder() {
        const amt = document.getElementById('amount').value;
        const phone = document.getElementById('userWallet').value;
        if(!amt || !phone) return alert("Ø²Ø§Ù†ÛŒØ§Ø±ÛŒÛŒÛ•Ú©Ø§Ù† ØªÛ•ÙˆØ§Ùˆ Ø¨Ú©Û•");

        const id = "ZN-" + Math.floor(Math.random()*90000);
        await db.ref('orders/' + id).set({
            uEmail: auth.currentUser.email,
            uName: auth.currentUser.displayName,
            total: amt + " IQD",
            userPhone: phone,
            status: 'Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†Û•',
            from: document.getElementById('method').value,
            time: new Date().toLocaleString('ku-IQ')
        });
        alert("Ù†ÛŽØ±Ø¯Ø±Ø§ âœ…");
    }

    function updateW() {
        const nums = { "FastPay": "7510074008", "Asiacell": "07758887488", "Korek": "07510074008" };
        document.getElementById('walletNum').innerText = nums[document.getElementById('method').value];
    }
</script>
</body>
</html>
