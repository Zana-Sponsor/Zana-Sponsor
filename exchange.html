<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>ZANA EXCHANGE | Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        @font-face { font-family: 'Afarin'; src: url('UniQAIDAR_Afarin_002.ttf') format('truetype'); font-display: swap; }
        :root { --accent: #facc15; --bg-deep: #050810; --card-bg: rgba(17, 24, 39, 0.85); --text-main: #f3f4f6; --text-dim: #9ca3af; --glass-border: rgba(255, 255, 255, 0.08); --success: #10b981; --danger: #ef4444; }
        body { font-family: 'Afarin', Tahoma, sans-serif; background: var(--bg-deep); color: var(--text-main); margin: 0; padding: 15px; min-height: 100vh; }

        /* Sidebar */
        .sidebar { position: fixed; top: 0; right: -280px; width: 260px; height: 100%; background: #111827; z-index: 3000; transition: 0.4s; padding: 30px 20px; box-shadow: -10px 0 30px rgba(0,0,0,0.8); border-left: 1px solid var(--glass-border); }
        .sidebar.active { right: 0; }
        .menu-item { display: flex; align-items: center; gap: 12px; padding: 15px; color: var(--text-main); border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; font-weight: bold; }
        .menu-item i { color: var(--accent); }

        .container { max-width: 460px; margin: auto; display: none; }
        .header-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .glass-card { background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 35px; padding: 25px; backdrop-filter: blur(25px); box-shadow: 0 25px 60px rgba(0,0,0,0.5); margin-bottom: 25px; }

        /* Order Cards */
        .order-card { background: rgba(255, 255, 255, 0.03); border: 1px solid var(--glass-border); border-radius: 25px; padding: 18px; margin-bottom: 15px; position: relative; }
        .status-badge { position: absolute; top: 12px; left: 12px; font-size: 10px; padding: 4px 10px; border-radius: 10px; background: rgba(250, 204, 21, 0.1); color: var(--accent); border: 1px solid rgba(250, 204, 21, 0.2); }
        .order-details { display: flex; align-items: center; justify-content: space-between; text-align: center; margin-top: 10px; }
        .color-send { color: var(--danger); font-weight: bold; }
        .color-receive { color: var(--success); font-weight: bold; }

        /* Inputs */
        .wallet-display { background: rgba(0,0,0,0.4); border-radius: 22px; padding: 18px; margin-bottom: 25px; border: 1px solid rgba(250, 204, 21, 0.25); text-align: center; }
        select, input { width: 100%; background: rgba(255, 255, 255, 0.04); border: 1px solid var(--glass-border); border-radius: 18px; padding: 16px; color: #fff; font-family: 'Afarin'; outline: none; font-size: 16px !important; }
        .btn-premium { background: var(--accent); color: #000; width: 100%; padding: 20px; border: none; border-radius: 22px; font-weight: bold; font-size: 18px; cursor: pointer; font-family: 'Afarin'; }

        #loginOverlay { position: fixed; inset: 0; background: var(--bg-deep); display: flex; align-items: center; justify-content: center; z-index: 2000; }
        .avatar { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--accent); cursor: pointer; }
    </style>
</head>
<body>

<div class="sidebar" id="sidebar">
    <div style="text-align: left; margin-bottom: 30px;"><i class="fas fa-times" onclick="toggleMenu()" style="font-size: 24px; cursor: pointer;"></i></div>
    <div class="menu-item" onclick="scrollToHistory()"><i class="fas fa-history"></i> ئۆردەرەکانم</div>
    <a href="https://wa.me/9647758887488" class="menu-item"><i class="fas fa-headset"></i> سەپۆرت</a>
    <div class="menu-item" onclick="logout()" style="color:var(--danger); margin-top: 20px;"><i class="fas fa-sign-out-alt"></i> چوونەدەرەوە</div>
</div>

<div id="loginOverlay">
    <div class="glass-card" style="text-align:center; width:85%; max-width: 380px;">
        <div style="width: 70px; height: 70px; background: var(--accent); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;"><i class="fas fa-exchange-alt" style="font-size: 30px;"></i></div>
        <h2 style="color:var(--accent); margin:0;">ZANA EXCHANGE</h2>
        <button onclick="signIn()" style="width:100%; padding:16px; border-radius:18px; border:none; background:#fff; font-weight:bold; display:flex; align-items:center; justify-content:center; gap:10px; cursor:pointer; font-family:'Afarin'; margin-top:25px;"><img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18"> Google چوونەژوورەوە</button>
        <div onclick="enterAsGuest()" style="margin-top:20px; cursor:pointer; color:var(--text-dim); font-size: 14px;">چوونەژوورەوە وەک میوان</div>
    </div>
</div>

<div class="container" id="mainApp">
    <div class="header-nav">
        <i class="fas fa-bars" onclick="toggleMenu()" style="font-size: 24px; color: var(--accent); cursor: pointer;"></i>
        <span style="font-weight: bold;">ZANA EXCHANGE</span>
        <img id="userImg" src="" class="avatar" onclick="toggleMenu()">
    </div>

    <div class="glass-card">
        <div class="wallet-display">
            <small style="color:var(--accent)">ناونیشانی ئێمە بۆ ناردن</small>
            <div style="direction:ltr; font-family:monospace; margin-top:5px;"><span id="myNum">هەڵبژێرە...</span> <i class="far fa-copy" onclick="copyNum()"></i></div>
        </div>

        <div style="margin-bottom:15px;">
            <label style="font-size:12px; color:var(--text-dim)">ناردن لەڕێگەی</label>
            <select id="from" onchange="updateWallet()">
                <option value="FastPay">FastPay</option><option value="FIB">FIB</option><option value="QiCard">QiCard</option>
                <option value="USDT">USDT (دۆلار)</option><option value="Asiacell">Asiacell</option><option value="Korek">Korek</option>
            </select>
        </div>

        <div style="margin-bottom:15px;">
            <label id="amtLabel" style="font-size:12px; color:var(--text-dim)">بڕی نێردراو</label>
            <input type="number" id="amt" placeholder="0" oninput="calc()">
        </div>

        <div style="margin-bottom:15px;">
            <label style="font-size:12px; color:var(--text-dim)">وەرگرتن لەڕێگەی</label>
            <select id="receiveVia" onchange="calc()">
                <option value="FastPay">FastPay</option><option value="FIB">FIB</option><option value="QiCard">QiCard</option>
            </select>
        </div>

        <div style="background:rgba(255,255,255,0.03); padding:15px; border-radius:18px; text-align:center; margin-bottom:20px;">
            <div id="totalDisplay" style="font-size:24px; color:var(--accent); font-weight:bold;">0 دینار</div>
        </div>

        <input type="tel" id="userPhone" placeholder="ژمارەی وەرگرتنی تۆ" style="margin-bottom:20px;">
        <button class="btn-premium" onclick="processOrder()">ناردنی داواکاری</button>
    </div>

    <h4 id="historyTitle" style="margin:20px 5px;"><i class="fas fa-history"></i> مێژووی ئۆردەرەکان</h4>
    <div id="historyList"></div>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyB056_g2Y3AJjtjG9715FgtXIhtjFcMPPU", authDomain: "zana-exchange.firebaseapp.com", databaseURL: "https://zana-exchange-default-rtdb.firebaseio.com", projectId: "zana-exchange" };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth(); const db = firebase.database();
    let isGuest = false;

    function toggleMenu() { document.getElementById('sidebar').classList.toggle('active'); }
    function scrollToHistory() { toggleMenu(); document.getElementById('historyTitle').scrollIntoView({behavior: 'smooth'}); }
    function signIn() { isGuest = false; auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
    function enterAsGuest() { isGuest = true; document.getElementById('loginOverlay').style.display = 'none'; document.getElementById('mainApp').style.display = 'block'; document.getElementById('userImg').src = "https://cdn-icons-png.flaticon.com/512/149/149071.png"; document.getElementById('historyList').innerHTML = "<p style='text-align:center; opacity:0.4;'>بۆ بینینی ئۆردەرەکانت پێویستە بچیتە ژوورەوە</p>"; }
    function logout() { auth.signOut().then(() => location.reload()); }

    auth.onAuthStateChanged(user => { if (user && !isGuest) { document.getElementById('loginOverlay').style.display = 'none'; document.getElementById('mainApp').style.display = 'block'; document.getElementById('userImg').src = user.photoURL; loadHistory(user.email); } });

    const staticWallets = { "FastPay": "07510074008", "FIB": "07510074008", "QiCard": "07758887488", "USDT": "TTaNnxWNt2bjgSvpRY7NpvyCHUXDi6wjYc", "Asiacell": "0770XXXXXXX", "Korek": "0750XXXXXXX" };
    function updateWallet() { document.getElementById('myNum').innerText = staticWallets[document.getElementById('from').value]; calc(); }

    function calc() {
        const amt = parseFloat(document.getElementById('amt').value) || 0;
        const fromVal = document.getElementById('from').value; const toVal = document.getElementById('receiveVia').value;
        let final = 0;
        if (fromVal === 'Asiacell') { final = (toVal === 'FastPay') ? amt * 0.84 : (toVal === 'FIB' ? amt * 0.83 : amt * 0.835); }
        else if (fromVal === 'Korek') { final = (toVal === 'FastPay') ? amt * 0.82 : (toVal === 'FIB' ? amt * 0.81 : amt * 0.815); }
        else if (fromVal === 'USDT') { final = (toVal === 'FastPay') ? amt * 1450 : (toVal === 'FIB' ? amt * 1440 : amt * 1445); }
        else { final = amt * 0.99; }
        document.getElementById('totalDisplay').innerText = Math.floor(final).toLocaleString() + " دینار";
    }

    async function processOrder() {
        if(isGuest) {
            alert("⚠️ تۆ وەک میوان چوویتەتە ژوورەوە. تکایە سەرەتا بە گووگڵ بچۆ ژوورەوە بۆ ئەوەی بتوانیت ئۆردەر بکەیت.");
            location.reload();
            return;
        }
        const amt = document.getElementById('amt').value; const ph = document.getElementById('userPhone').value;
        if(!amt || ph.length < 10) return alert("زانیارییەکان تەواو بکە");
        const orderId = Math.floor(10000 + Math.random() * 90000);
        await db.ref('orders/' + orderId).set({ uEmail: auth.currentUser.email, orderID: orderId, amt: parseFloat(amt).toLocaleString(), total: document.getElementById('totalDisplay').innerText, from: document.getElementById('from').value, to: document.getElementById('receiveVia').value, status: 'لە چاوەڕوانیدایە', time: new Date().toLocaleString('ku-IQ') });
        window.open(`https://wa.me/9647758887488?text=ئۆردەری نوێ #${orderId}`, '_blank');
        location.reload();
    }

    function loadHistory(email) {
        db.ref('orders').orderByChild('uEmail').equalTo(email).on('value', snap => {
            let html = "";
            snap.forEach(c => { const o = c.val(); html = `<div class="order-card"><span class="status-badge">${o.status}</span><div class="order-header"><span style="color:var(--accent)">#${o.orderID}</span><small style="opacity:0.4">${o.time}</small></div><div class="order-details"><div><small>ناردن</small><div class="color-send">${o.from}</div><small>${o.amt}</small></div><i class="fas fa-exchange-alt" style="opacity:0.2"></i><div><small>وەرگرتن</small><div class="color-receive">${o.to}</div><small>${o.total}</small></div></div></div>` + html; });
            document.getElementById('historyList').innerHTML = html || "<p style='text-align:center; opacity:0.3;'>هیچ ئۆردەرێک نییە</p>";
        });
    }

    function copyNum() { navigator.clipboard.writeText(document.getElementById('myNum').innerText); alert("کۆپی کرا ✅"); }
    updateWallet();
</script>
</body>
</html>
