<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zana Exchange | Ø¦Ø§ÚµÙˆÚ¯Û†Ú•ÛŒ Ø¨Ø§ÚµØ§Ù†Ø³</title>
    <style>
        :root { --main: #facc15; --bg: #0f172a; --card: #1e293b; --success: #10b981; }
        body { font-family: 'Tahoma', sans-serif; background: var(--bg); color: white; margin: 0; padding: 15px; text-align: right; }
        .container { max-width: 400px; margin: auto; }
        .card { background: var(--card); padding: 25px; border-radius: 25px; border: 1px solid #334155; box-shadow: 0 15px 35px rgba(0,0,0,0.5); }
        .logo { text-align: center; font-size: 26px; font-weight: bold; color: var(--main); margin-bottom: 20px; }
        .wallet { background: rgba(15, 23, 42, 0.8); padding: 15px; border-radius: 18px; text-align: center; border: 1px solid var(--main); margin-bottom: 25px; }
        .num { font-size: 21px; font-weight: bold; display: block; margin: 8px 0; letter-spacing: 1px; color: #fff; }
        .copy-btn { background: var(--main); border: none; padding: 8px 20px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 13px; }
        .group { margin-bottom: 15px; }
        label { display: block; font-size: 13px; color: #94a3b8; margin-bottom: 5px; }
        select, input { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #334155; background: #0f172a; color: white; outline: none; box-sizing: border-box; font-size: 16px; font-family: 'Tahoma'; }
        .res-box { background: rgba(16, 185, 129, 0.15); padding: 15px; border-radius: 15px; margin: 20px 0; border-right: 4px solid var(--success); text-align: center; }
        .total { font-size: 24px; font-weight: bold; color: var(--success); }
        .file-label { display: block; background: #334155; padding: 12px; border-radius: 12px; text-align: center; cursor: pointer; border: 1px dashed var(--main); margin-top: 5px; }
        #imageInput { display: none; }
        #imagePreview { width: 100%; border-radius: 12px; margin-top: 15px; display: none; border: 2px solid var(--main); }
        .btn { background: linear-gradient(90deg, #facc15, #eab308); color: #000; border: none; width: 100%; padding: 18px; border-radius: 15px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .history { margin-top: 30px; }
        .hist-item { background: #1e293b; padding: 10px; border-radius: 10px; margin-bottom: 8px; font-size: 12px; border-left: 4px solid var(--main); }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <div class="logo">ZANA EXCHANGE</div>
        
        <div class="wallet" id="walletBox">
            <span id="walletTitle" style="font-size: 11px; color: var(--main);">Ø¨Û† Ù†Ø§Ø±Ø¯Ù†ÛŒ Ù¾Ø§Ø±Û• (ÙØ§Ø³ØªÙ¾Û•ÛŒØŒ FIB)</span>
            <span class="num" id="myNum">07510074008</span>
            <button class="copy-btn" onclick="copyNum()">Ú©Û†Ù¾ÛŒ Ø¨Ú©Û• / Copy</button>
        </div>

        <div class="group">
            <label>Ù„Û• Ú©ÙˆÛÙˆÛ• Ø¯Û•ÛŒÙ†ÛØ±ÛŒØªØŸ / From</label>
            <select id="from" onchange="updateWallet()">
                <option value="ÙØ§Ø³ØªÙ¾Û•ÛŒ (FastPay)">ÙØ§Ø³ØªÙ¾Û•ÛŒ (FastPay)</option>
                <option value="Ø¦ÛÙ Ø¦Ø§ÛŒ Ø¨ÛŒ (FIB)">Ø¦ÛÙ Ø¦Ø§ÛŒ Ø¨ÛŒ (FIB)</option>
                <option value="Ú©ÙŠ Ú©Ø§Ø±Ø¯ (QiCard)">Ú©ÙŠ Ú©Ø§Ø±Ø¯ (QiCard)</option>
            </select>
        </div>

        <div class="group">
            <label>Ø¨Û† Ú©ÙˆÛ Ø¨Ú¯Û†Ú•Ø¯Ø±ÛØªØŸ / To</label>
            <select id="to" onchange="calc()">
                <option value="Ø¦ÛÙ Ø¦Ø§ÛŒ Ø¨ÛŒ (FIB)">Ø¦ÛÙ Ø¦Ø§ÛŒ Ø¨ÛŒ (FIB)</option>
                <option value="ÙØ§Ø³ØªÙ¾Û•ÛŒ (FastPay)">ÙØ§Ø³ØªÙ¾Û•ÛŒ (FastPay)</option>
                <option value="Ú©ÙŠ Ú©Ø§Ø±Ø¯ (QiCard)">Ú©ÙŠ Ú©Ø§Ø±Ø¯ (QiCard)</option>
            </select>
        </div>

        <div class="group">
            <label>Ø¨Ú•ÛŒ Ù†Ø§Ø±Ø¯Ù† / Amount (IQD)</label>
            <input type="number" id="amt" placeholder="100,000" oninput="calc()">
        </div>

        <div class="res-box">
            <div style="font-size: 12px; color: #94a3b8;">Ø¨Ú•ÛŒ ÙˆÛ•Ø±Ú¯Ø±ØªÙ† / Received Amount</div>
            <span class="total" id="total">0 Ø¯ÛŒÙ†Ø§Ø±</span>
            <div style="font-size: 10px; color: #94a3b8; margin-top: 5px;">(Ø¹Ù…ÙˆÙ„Û• 2,000 Ø¨Û† Ù‡Û•Ø± 100 Ù‡Û•Ø²Ø§Ø±ÛÚ©)</div>
        </div>

        <div class="group">
            <label>Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…Û†Ø¨Ø§ÛŒÙ„ÛŒ ØªÛ† (ÙˆÛ•Ø±Ú¯Ø±) / Receiver</label>
            <input type="text" id="userPhone" placeholder="07XXXXXXXX">
        </div>

        <div class="group">
            <label>ÙˆÛÙ†Û•ÛŒ ÙˆÛ•Ø³Úµ / Upload Receipt</label>
            <label for="imageInput" class="file-label" id="fileLabel">ğŸ“ Ù‡Û•ÚµØ¨Ú˜Ø§Ø±Ø¯Ù†ÛŒ ÙˆÛÙ†Û• / Select Photo</label>
            <input type="file" id="imageInput" accept="image/*" onchange="previewImg()">
            <img id="imagePreview">
        </div>

        <button class="btn" id="submitBtn" onclick="processOrder()">Ù†Ø§Ø±Ø¯Ù†ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ / Send Order</button>
    </div>

    <div class="history">
        <h4 style="color: var(--main); border-bottom: 1px solid #334155; padding-bottom: 5px;">Ù…ÛÚ˜ÙˆÙˆ / History</h4>
        <div id="histList"></div>
    </div>
</div>

<script>
    const BOT_TOKEN = "8570457708:AAG_5hFu-octgBn1ruDJ3_OzEG7p4fWiNgo";
    const CHAT_ID = "6259019006";

    function updateWallet() {
        const from = document.getElementById('from').value;
        const numElem = document.getElementById('myNum');
        const titleElem = document.getElementById('walletTitle');
        if(from.includes("QiCard")) {
            numElem.innerText = "07758887488";
            titleElem.innerText = "Ø¨Û† Ù†Ø§Ø±Ø¯Ù†ÛŒ Ù¾Ø§Ø±Û• (Ú©ÙŠ Ú©Ø§Ø±Ø¯)";
        } else {
            numElem.innerText = "07510074008";
            titleElem.innerText = "Ø¨Û† Ù†Ø§Ø±Ø¯Ù†ÛŒ Ù¾Ø§Ø±Û• (ÙØ§Ø³ØªÙ¾Û•ÛŒØŒ FIB)";
        }
        calc();
    }

    function copyNum() {
        const num = document.getElementById('myNum').innerText;
        navigator.clipboard.writeText(num);
        alert("Ú©Û†Ù¾ÛŒ Ú©Ø±Ø§: " + num);
    }

    function calc() {
        const amt = document.getElementById('amt').value || 0;
        const fee = Math.floor(amt * 0.02);
        const result = amt - fee;
        document.getElementById('total').innerText = (result > 0 ? result.toLocaleString() : 0) + " Ø¯ÛŒÙ†Ø§Ø±";
    }

    function previewImg() {
        const file = document.getElementById('imageInput').files[0];
        if (file) {
            document.getElementById('imagePreview').src = URL.createObjectURL(file);
            document.getElementById('imagePreview').style.display = "block";
            document.getElementById('fileLabel').innerText = "âœ… ÙˆÛÙ†Û• Ù‡Û•ÚµØ¨Ú˜ÛØ±Ø¯Ø±Ø§";
        }
    }

    async function processOrder() {
        const fromVal = document.getElementById('from').value;
        const toVal = document.getElementById('to').value;
        const amtVal = document.getElementById('amt').value;
        const totalVal = document.getElementById('total').innerText;
        const phoneVal = document.getElementById('userPhone').value;
        const imgFile = document.getElementById('imageInput').files[0];
        const btn = document.getElementById('submitBtn');

        if(!amtVal || !phoneVal || !imgFile) return alert("ØªÚ©Ø§ÛŒÛ• Ø²Ø§Ù†ÛŒØ§Ø±ÛŒÛŒÛ•Ú©Ø§Ù† ØªÛ•ÙˆØ§Ùˆ Ø¨Ú©Û•");

        btn.innerText = "Ø®Û•Ø±ÛŒÚ©ÛŒ Ù†Ø§Ø±Ø¯Ù†Û•...";
        btn.disabled = true;

        const dateTime = new Date().toLocaleString('ku-IQ');
        const details = `ğŸ†• Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ Ù†ÙˆÛ\n\nğŸ”„ Ú¯Û†Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ: ${fromVal} Ø¨Û† ${toVal}\nğŸ’µ Ø¨Ú•: ${parseInt(amtVal).toLocaleString()} Ø¯ÛŒÙ†Ø§Ø±\nğŸ’° ÙˆÛ•Ø±Ú¯Ø±ØªÙ†: ${totalVal}\nğŸ“± Ú˜Ù…Ø§Ø±Û•ÛŒ ÙˆÛ•Ø±Ú¯Ø±: ${phoneVal}\nğŸ“… Ú©Ø§Øª: ${dateTime}`;

        const formData = new FormData();
        formData.append("chat_id", CHAT_ID);
        formData.append("photo", imgFile);
        formData.append("caption", details);

        try {
            // 1. Ù†Ø§Ø±Ø¯Ù† Ø¨Û† ØªÛÙ„ÛŒÚ¯Ø±Ø§Ù…
            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, { method: "POST", body: formData });
            
            saveHistory(fromVal, toVal, amtVal);
            
            // 2. Ø¦Ø§Ù…Ø§Ø¯Û•Ú©Ø±Ø¯Ù†ÛŒ Ø¯Û•Ù‚ Ø¨Û† ÙˆØ§ØªØ³Ø¦Û•Ù¾
            const waText = `Ø³ÚµØ§ÙˆØŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ Ú¯Û†Ú•ÛŒÙ†Û•ÙˆÛ•Ù… Ù†Ø§Ø±Ø¯ÙˆÙˆÛ• Ø¨Û† ØªÛÙ„ÛŒÚ¯Ø±Ø§Ù…:\n\n` +
                           `ğŸ”„ Ø¬Û†Ø±: ${fromVal} Ø¨Û† ${toVal}\n` +
                           `ğŸ’µ Ø¨Ú•ÛŒ Ù†Ø§Ø±Ø¯Ø±Ø§Ùˆ: ${parseInt(amtVal).toLocaleString()} Ø¯ÛŒÙ†Ø§Ø±\n` +
                           `âœ… Ø¨Ú•ÛŒ ÙˆÛ•Ø±Ú¯Ø±ØªÙ†: ${totalVal}\n` +
                           `ğŸ“± Ú˜Ù…Ø§Ø±Û•ÛŒ ÙˆÛ•Ø±Ú¯Ø±: ${phoneVal}`;

            const targetWA = fromVal.includes("QiCard") ? "9647758887488" : "9647510074008";
            
            // 3. Ù†Ø§Ø±Ø¯Ù† Ø¨Û† ÙˆØ§ØªØ³Ø¦Û•Ù¾
            window.location.href = `https://wa.me/${targetWA}?text=${encodeURIComponent(waText)}`;
            
            setTimeout(() => location.reload(), 2000);
        } catch (err) {
            alert("Ù‡Û•ÚµÛ• Ú•ÙˆÙˆÛŒØ¯Ø§ Ù„Û• Ù†Ø§Ø±Ø¯Ù†ÛŒ Ø¯Ø§ØªØ§");
            btn.disabled = false;
        }
    }

    function saveHistory(from, to, amt) {
        const hist = { from, to, amt, date: new Date().toLocaleDateString() };
        let list = JSON.parse(localStorage.getItem('zana_hist') || "[]");
        list.unshift(hist);
        localStorage.setItem('zana_hist', JSON.stringify(list.slice(0, 5)));
    }

    function showHist() {
        const list = JSON.parse(localStorage.getItem('zana_hist') || "[]");
        document.getElementById('histList').innerHTML = list.map(i => `
            <div class="hist-item">
                <b>${i.from} â” ${i.to}</b><br>
                Ø¨Ú•: ${parseInt(i.amt).toLocaleString()} Ø¯ÛŒÙ†Ø§Ø± | ${i.date}
            </div>
        `).join('');
    }

    window.onload = showHist;
</script>

</body>
</html>
