<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>ZANA EXCHANGE | Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        @font-face { font-family: 'Afarin'; src: url('UniQAIDAR_Afarin_002.ttf') format('truetype'); font-display: swap; }
        :root { --accent: #facc15; --bg-deep: #050810; --card-bg: rgba(17, 24, 39, 0.85); --text-main: #f3f4f6; --text-dim: #9ca3af; --success: #10b981; --danger: #ef4444; --glass-border: rgba(255, 255, 255, 0.08); }
        
        body { font-family: 'Afarin', Tahoma, sans-serif; background: var(--bg-deep); color: var(--text-main); margin: 0; padding: 15px; min-height: 100vh; display: flex; flex-direction: column; align-items: center; }
        
        .container { width: 100%; max-width: 420px; display: none; text-align: center; }
        
        .glass-card { background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 35px; padding: 30px; backdrop-filter: blur(25px); box-shadow: 0 25px 60px rgba(0,0,0,0.5); margin-bottom: 25px; width: 100%; box-sizing: border-box; }
        
        .social-contact { display: flex; gap: 10px; margin-bottom: 20px; width: 100%; }
        .social-btn { flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px; padding: 12px; border-radius: 18px; text-decoration: none; color: #fff; font-size: 14px; font-weight: bold; border: 1px solid rgba(255,255,255,0.1); }
        
        .user-header { display: flex; flex-direction: column; align-items: center; gap: 10px; margin-bottom: 25px; }
        .avatar { width: 60px; height: 60px; border-radius: 50%; border: 3px solid var(--accent); box-shadow: 0 0 20px rgba(250, 204, 21, 0.2); }

        .field-group { margin-bottom: 20px; text-align: center; }
        .field-group label { display: block; font-size: 14px; color: var(--accent); margin-bottom: 10px; font-weight: bold; }
        .field-group label i { margin-left: 5px; }
        
        select, input { width: 100%; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--glass-border); border-radius: 20px; padding: 16px; color: #fff; font-family: 'Afarin'; text-align: center; outline: none; font-size: 16px; }
        
        .wallet-display { background: rgba(0,0,0,0.4); border-radius: 22px; padding: 15px; margin-bottom: 25px; border: 1px dashed var(--accent); }
        
        .result-pill { background: rgba(16, 185, 129, 0.1); padding: 20px; border-radius: 25px; margin: 20px 0; border: 1px solid rgba(16, 185, 129, 0.2); }
        #totalDisplay { font-size: 28px; font-weight: bold; color: var(--accent); margin-top: 5px; }

        .btn-premium { background: var(--accent); color: #000; width: 100%; padding: 20px; border: none; border-radius: 25px; font-weight: bold; font-size: 18px; cursor: pointer; font-family: 'Afarin'; transition: 0.3s; }
        .btn-premium:active { transform: scale(0.98); }

        .order-ticket { background: rgba(255,255,255,0.03); border-radius: 25px; padding: 20px; margin-bottom: 15px; border: 1px solid var(--glass-border); text-align: center; position: relative; }
        .status-badge { position: absolute; top: 12px; left: 15px; font-size: 10px; padding: 4px 10px; border-radius: 10px; background: rgba(250,204,21,0.1); color: var(--accent); }

        #loginOverlay { position: fixed; inset: 0; background: var(--bg-deep); display: flex; align-items: center; justify-content: center; z-index: 2000; text-align: center; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="glass-card" style="width: 85%;">
        <div style="font-size: 50px; color: var(--accent); margin-bottom: 15px;"><i class="fas fa-sync-alt"></i></div>
        <h2 style="color:var(--accent); margin:0;">Ø²Ø§Ù†Ø§ Ø¦ÛÚ©Ø³Ú†Û•ÛŒÙ†Ø¬</h2>
        <p style="color:var(--text-dim); margin:15px 0 25px;">Ø®ÛØ±Ø§ØªØ±ÛŒÙ† Ø¨Û† Ú¯Û†Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø¯Ø±Ø§Ùˆ</p>
        <button onclick="signIn()" style="width:100%; padding:16px; border-radius:20px; border:none; background:#fff; font-weight:bold; display:flex; align-items:center; justify-content:center; gap:10px; cursor:pointer; font-family:'Afarin';"><img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20"> Google Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</button>
        <button onclick="enterAsGuest()" style="background:transparent; color:var(--text-dim); border:1px solid var(--glass-border); width:100%; padding:14px; border-radius:20px; margin-top:15px; cursor:pointer; font-family:'Afarin';">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• ÙˆÛ•Ú© Ù…ÛŒÙˆØ§Ù†</button>
    </div>
</div>

<div class="container" id="mainApp">
    <div class="user-header">
        <img id="userImg" src="" class="avatar">
        <div>
            <div id="userName" style="font-weight:bold; font-size:18px;">...</div>
            <span onclick="logout()" style="color:var(--danger); font-size:12px; cursor:pointer;"><i class="fas fa-power-off"></i> Ú†ÙˆÙˆÙ†Û•Ø¯Û•Ø±Û•ÙˆÛ•</span>
        </div>
    </div>

    <div class="social-contact">
        <a href="https://t.me/zana_exchange" class="social-btn" style="background:#0088cc;"><i class="fab fa-telegram"></i> ØªÛÙ„ÛŒÚ¯Ø±Ø§Ù…</a>
        <a href="https://wa.me/9647510074008" class="social-btn" style="background:#25d366;"><i class="fab fa-whatsapp"></i> ÙˆØ§ØªØ³Ø¦Ø§Ù¾</a>
    </div>

    <div class="glass-card">
        <div class="wallet-display">
            <small style="color:var(--accent); display:block; margin-bottom:8px;"><i class="fas fa-info-circle"></i> Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù†ÛŒ Ø¦ÛÙ…Û• Ø¨Û† Ù†Ø§Ø±Ø¯Ù†</small>
            <div style="direction:ltr; font-family:monospace; font-size:16px; font-weight:bold;">
                <span id="myNum">Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•...</span>
                <i class="far fa-copy" style="color:var(--accent); cursor:pointer; margin-left:10px;" onclick="copyNum()"></i>
            </div>
        </div>

        <div class="field-group">
            <label><i class="fas fa-paper-plane"></i> Ù†Ø§Ø±Ø¯Ù† Ù„Û•Ú•ÛÚ¯Û•ÛŒ</label>
            <select id="from" onchange="updateWallet()">
                <option value="FastPay">ğŸ’³ FastPay</option>
                <option value="FIB">ğŸ¦ FIB</option>
                <option value="QiCard">ğŸ§ QiCard</option>
                <option value="USDT">ğŸª™ USDT (TRC20)</option>
                <option value="Asiacell">ğŸ“± Asiacell (Ø¨Ø§ÚµØ§Ù†Ø³)</option>
                <option value="Korek">ğŸ“± Korek (Ø¨Ø§ÚµØ§Ù†Ø³)</option>
            </select>
        </div>

        <div class="field-group">
            <label id="amtLabel"><i class="fas fa-coins"></i> Ø¨Ú•ÛŒ Ù†ÛØ±Ø¯Ø±Ø§Ùˆ</label>
            <input type="number" id="amt" placeholder="0" oninput="calc()">
        </div>

        <div class="field-group">
            <label><i class="fas fa-hand-holding-usd"></i> ÙˆÛ•Ø±Ú¯Ø±ØªÙ† Ù„Û•Ú•ÛÚ¯Û•ÛŒ</label>
            <select id="receiveVia" onchange="calc()">
                <option value="FastPay">ğŸ’³ FastPay</option>
                <option value="FIB">ğŸ¦ FIB</option>
                <option value="QiCard">ğŸ§ QiCard</option>
            </select>
        </div>

        <div class="result-pill">
            <span style="font-size:12px; color:var(--text-dim); display:block;">Ø¨Ú•ÛŒ ÙˆÛ•Ø±Ú¯ÛŒØ±Ø§Ùˆ Ø¨Û† ØªÛ†</span>
            <div id="totalDisplay">0 Ø¯ÛŒÙ†Ø§Ø±</div>
        </div>

        <div class="field-group">
            <label><i class="fas fa-phone-alt"></i> Ú˜Ù…Ø§Ø±Û•ÛŒ ÙˆÛ•Ø±Ú¯Ø±ØªÙ†ÛŒ ØªÛ†</label>
            <input type="tel" id="userPhone" placeholder="07XXXXXXXXX">
        </div>

        <button class="btn-premium" onclick="processOrder()"><i class="fas fa-check-circle"></i> Ù†Ø§Ø±Ø¯Ù†ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ</button>
    </div>

    <h4 style="margin:30px 0 15px; color:var(--accent);"><i class="fas fa-history"></i> Ø¯ÙˆØ§ÛŒÛŒÙ† Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Ø§Ù†</h4>
    <div id="historyList"></div>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyB056_g2Y3AJjtjG9715FgtXIhtjFcMPPU", authDomain: "zana-exchange.firebaseapp.com", databaseURL: "https://zana-exchange-default-rtdb.firebaseio.com", projectId: "zana-exchange" };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth(); const db = firebase.database();
    let isGuest = false;

    function signIn() { isGuest = false; auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
    function enterAsGuest() { isGuest = true; document.getElementById('loginOverlay').style.display = 'none'; document.getElementById('mainApp').style.display = 'block'; document.getElementById('userName').innerText = "Ù…ÛŒÙˆØ§Ù† (Guest)"; document.getElementById('userImg').src = "https://cdn-icons-png.flaticon.com/512/149/149071.png"; }
    function logout() { auth.signOut().then(() => location.reload()); }

    auth.onAuthStateChanged(user => { if (user && !isGuest) { document.getElementById('loginOverlay').style.display = 'none'; document.getElementById('mainApp').style.display = 'block'; document.getElementById('userName').innerText = user.displayName; document.getElementById('userImg').src = user.photoURL; loadHistory(user.email); } });

    const wallets = { "FastPay": "07510074008", "FIB": "07510074008", "QiCard": "07758887488", "USDT": "TTaNnxWNt2bjgSvpRY7NpvyCHUXDi6wjYc", "Asiacell": "0770XXXXXXX", "Korek": "0750XXXXXXX" };
    function updateWallet() { document.getElementById('myNum').innerText = wallets[document.getElementById('from').value]; calc(); }

    function calc() {
        const amt = parseFloat(document.getElementById('amt').value) || 0;
        const from = document.getElementById('from').value;
        const to = document.getElementById('receiveVia').value;
        let final = 0;
        if (from === 'Asiacell') final = (to === 'FastPay') ? amt * 0.84 : (to === 'FIB' ? amt * 0.83 : amt * 0.835);
        else if (from === 'Korek') final = (to === 'FastPay') ? amt * 0.82 : (to === 'FIB' ? amt * 0.81 : amt * 0.815);
        else if (from === 'USDT') final = (to === 'FastPay') ? amt * 1450 : (to === 'FIB' ? amt * 1440 : amt * 1445);
        else final = amt * 0.99;
        document.getElementById('totalDisplay').innerText = Math.floor(final).toLocaleString() + " Ø¯ÛŒÙ†Ø§Ø±";
    }

    async function processOrder() {
        if(isGuest) return alert("âš ï¸ ØªÚ©Ø§ÛŒÛ• Ø¨Û• Ú¯ÙˆÙˆÚ¯Úµ Ø¨Ú†Û† Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Û† Ù†Ø§Ø±Ø¯Ù†ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ.");
        const amt = document.getElementById('amt').value; const ph = document.getElementById('userPhone').value;
        if(!amt || ph.length < 10) return alert("ØªÚ©Ø§ÛŒÛ• Ù‡Û•Ù…ÙˆÙˆ Ø®Ø§Ù†Û•Ú©Ø§Ù† Ù¾Ú• Ø¨Ú©Û•Ø±Û•ÙˆÛ•.");
        const orderId = Math.floor(10000 + Math.random() * 90000);
        const data = { uEmail: auth.currentUser.email, orderID: orderId, amt: parseFloat(amt).toLocaleString(), total: document.getElementById('totalDisplay').innerText, from: document.getElementById('from').value, to: document.getElementById('receiveVia').value, status: 'Ù„Û• Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†ÛŒØ¯Ø§ÛŒÛ•', time: new Date().toLocaleString('ku-IQ') };
        await db.ref('orders/' + orderId).set(data);
        window.open(`https://wa.me/9647510074008?text=Ø¦Û†Ø±Ø¯Û•Ø±ÛŒ Ù†ÙˆÛ #${orderId}`, '_blank');
        location.reload();
    }

    function loadHistory(email) {
        db.ref('orders').orderByChild('uEmail').equalTo(email).on('value', snap => {
            let html = "";
            snap.forEach(c => { const o = c.val(); html = `<div class="order-ticket"><span class="status-badge">${o.status}</span><div style="margin-bottom:10px;"><b>#${o.orderID}</b></div><div style="display:flex; justify-content:space-around; align-items:center;"><div style="color:var(--danger)">${o.from}<br><small>${o.amt}</small></div><i class="fas fa-long-arrow-alt-left" style="opacity:0.3"></i><div style="color:var(--success)">${o.to}<br><small>${o.total}</small></div></div><div style="font-size:10px; opacity:0.3; margin-top:10px;">${o.time}</div></div>` + html; });
            document.getElementById('historyList').innerHTML = html || "<p style='opacity:0.3;'>Ù‡ÛŒÚ† Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú© ØªÛ†Ù…Ø§Ø± Ù†Û•Ú©Ø±Ø§ÙˆÛ•</p>";
        });
    }

    function copyNum() { navigator.clipboard.writeText(document.getElementById('myNum').innerText); alert("Ú©Û†Ù¾ÛŒ Ú©Ø±Ø§ âœ…"); }
    updateWallet();
</script>
</body>
</html>
