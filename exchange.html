<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zana Exchange | Pro Full v2.9</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --main: #facc15; --bg: #0f172a; --card: #1e293b; --success: #10b981; --danger: #ef4444; --gold: linear-gradient(135deg, #facc15 0%, #eab308 100%); }
        body { font-family: 'Tahoma', sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; text-align: right; }
        .container { max-width: 400px; margin: auto; }
        
        /* Support Section */
        .support-header { background: rgba(37, 211, 102, 0.1); border: 1px solid #25d366; padding: 12px; border-radius: 15px; text-align: center; margin-bottom: 15px; }
        .support-link { text-decoration: none; color: #25d366; font-weight: bold; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px; }

        .card { background: var(--card); padding: 25px; border-radius: 25px; border: 1px solid #334155; box-shadow: 0 15px 35px rgba(0,0,0,0.5); margin-bottom: 20px; position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 5px; background: var(--gold); }
        
        /* Logo Section */
        .logo-section { text-align: center; margin-bottom: 20px; }
        .logo-circle { width: 60px; height: 60px; background: var(--gold); margin: 0 auto 10px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #0f172a; font-size: 25px; }
        .logo-title { font-size: 22px; font-weight: 900; color: var(--main); display: block; }

        .wallet { background: rgba(15, 23, 42, 0.8); padding: 12px; border-radius: 18px; text-align: center; border: 1px solid var(--main); margin-bottom: 20px; }
        .num { font-size: 16px; font-weight: bold; font-family: monospace; display: block; margin: 5px 0; }
        .group { margin-bottom: 12px; }
        label { display: block; font-size: 12px; color: #94a3b8; margin-bottom: 5px; }
        select, input { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #334155; background: #0f172a; color: white; outline: none; box-sizing: border-box; }
        .res-box { background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 15px; margin: 15px 0; border: 1px solid var(--success); text-align: center; }
        .total { font-size: 20px; font-weight: bold; color: var(--success); }
        .file-label { display: block; background: #334155; padding: 12px; border-radius: 12px; text-align: center; cursor: pointer; border: 1px dashed var(--main); font-size: 13px; margin-bottom: 10px; }
        #imageInput { display: none; }
        #imagePreview { width: 100%; border-radius: 12px; margin-top: 10px; display: none; border: 2px solid var(--main); }
        .btn { background: var(--gold); color: #000; border: none; width: 100%; padding: 15px; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; }

        /* History */
        .hist-item { background: rgba(30, 41, 59, 0.8); padding: 16px; border-radius: 20px; margin-bottom: 15px; border-right: 6px solid var(--main); box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .hist-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 8px; }
        .hist-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; font-size: 13px; }
    </style>
</head>
<body>

<div class="container">
    <div class="support-header">
        <a href="https://wa.me/9647758887488?text=Ø³ÚµØ§Ùˆ" class="support-link">
            <i class="fab fa-whatsapp"></i> Ø¨Û† Ù‡Û•Ø± Ú©ÛØ´Û•ÛŒÛ•Ú© (WhatsApp Support)
        </a>
    </div>

    <div class="card">
        <div class="logo-section">
            <div class="logo-circle"><i class="fas fa-exchange-alt"></i></div>
            <span class="logo-title">ZANA EXCHANGE</span>
        </div>
        
        <div class="wallet">
            <span style="font-size: 10px; color: var(--main);">Ø¨Û† Ù†Ø§Ø±Ø¯Ù†ÛŒ Ù¾Ø§Ø±Û• (Send To)</span>
            <span class="num" id="myNum">07510074008</span>
        </div>

        <div class="group">
            <label>Ø¬Û†Ø±ÛŒ Ù†Ø§Ø±Ø¯Ù†</label>
            <select id="from" onchange="updateWallet()">
                <option value="FastPay">FastPay</option>
                <option value="FIB">FIB</option>
                <option value="QiCard">QiCard</option>
                <option value="USDT">USDT</option>
                <option value="Korek">Korek Card</option>
            </select>
        </div>

        <div class="group"><label>Ú˜Ù…Ø§Ø±Û•ÛŒ Ù†ÛØ±Û•Ø±</label><input type="text" id="senderPhone" placeholder="07XXXXXXXX"></div>
        <div class="group"><label>Ø¨Ú•ÛŒ Ù†Ø§Ø±Ø¯Ù†</label><input type="number" id="amt" placeholder="100000" oninput="calc()"></div>
        <div class="res-box"><span class="total" id="total">0 Ø¯ÛŒÙ†Ø§Ø±</span></div>
        <div class="group"><label>Ú˜Ù…Ø§Ø±Û•ÛŒ ÙˆÛ•Ø±Ú¯Ø±</label><input type="text" id="userPhone" placeholder="07XXXXXXXX"></div>
        
        <div class="group">
            <label for="imageInput" class="file-label"><i class="fas fa-camera"></i> ÙˆÛÙ†Û•ÛŒ ÙˆÛ•Ø³ÚµÛ•Ú©Û• Ù„ÛØ±Û• Ø¯Ø§Ø¨Ù†Û</label>
            <input type="file" id="imageInput" accept="image/*" onchange="previewImg()">
            <img id="imagePreview">
        </div>

        <button class="btn" id="submitBtn" onclick="processOrder()">Ù†Ø§Ø±Ø¯Ù†ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ</button>
    </div>

    <div class="history-section">
        <h4 style="color:var(--main); margin-right: 10px;"><i class="fas fa-history"></i> Ù…ÛÚ˜ÙˆÙˆÛŒ Ù…Ø§Ù…Û•ÚµÛ•Ú©Ø§Ù†</h4>
        <div id="historyList">Ø¨Ø§Ø±Ø¯Û•Ú©Ø±ÛØª...</div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyB056_g2Y3AJjtjG9715FgtXIhtjFcMPPU",
        authDomain: "zana-exchange.firebaseapp.com",
        databaseURL: "https://zana-exchange-default-rtdb.firebaseio.com",
        projectId: "zana-exchange"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const BOT_TOKEN = "8570457708:AAG_5hFu-octgBn1ruDJ3_OzEG7p4fWiNgo";
    const CHAT_ID = "6259019006";

    function updateWallet() {
        const from = document.getElementById('from').value;
        const numElem = document.getElementById('myNum');
        if(from === "QiCard") numElem.innerText = "07758887488";
        else if(from === "USDT") numElem.innerText = "TTaNnxWNt2bjgSvpRY7NpvyCHUXDi6wjYc";
        else numElem.innerText = "07510074008";
        calc();
    }

    function calc() {
        const amt = parseFloat(document.getElementById('amt').value) || 0;
        const from = document.getElementById('from').value;
        let fee = 0.98;
        if(from === "Korek") fee = 0.82;
        document.getElementById('total').innerText = Math.floor(amt * fee).toLocaleString() + " Ø¯ÛŒÙ†Ø§Ø±";
    }

    function previewImg() {
        const file = document.getElementById('imageInput').files[0];
        if (file) {
            document.getElementById('imagePreview').src = URL.createObjectURL(file);
            document.getElementById('imagePreview').style.display = "block";
        }
    }

    async function processOrder() {
        const from = document.getElementById('from').value;
        const senderPh = document.getElementById('senderPhone').value;
        const amt = document.getElementById('amt').value;
        const userPh = document.getElementById('userPhone').value;
        const total = document.getElementById('total').innerText;
        const imgFile = document.getElementById('imageInput').files[0];
        const btn = document.getElementById('submitBtn');

        if(!amt || !senderPh || !userPh || !imgFile) return alert("ØªÚ©Ø§ÛŒÛ• Ù‡Û•Ù…ÙˆÙˆ Ø²Ø§Ù†ÛŒØ§Ø±ÛŒÛŒÛ•Ú©Ø§Ù† Ù¾Ú• Ø¨Ú©Û•Ø±Û•ÙˆÛ•");

        btn.disabled = true; btn.innerText = "Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù† Ø¨Û•...";
        const orderID = Math.floor(10000 + Math.random() * 90000);
        const timeString = new Date().toLocaleString('ku-IQ');

        try {
            await db.ref('orders/' + orderID).set({
                orderID, from, senderPh, userPh, amt, total, status: 'pending', time: timeString
            });

            const caption = `ğŸ†” Ø¦Û†Ø±Ø¯Û•Ø±: #${orderID}\nğŸ“± Ù†ÛØ±Û•Ø±: ${senderPh}\nğŸ’° Ø¨Ú•: ${amt}\nğŸ§ Ø¬Ø²Ø¯Ø§Ù†: ${from}\nâœ… ÙˆÛ•Ø±Ú¯Ø±ØªÙ†: ${total}\nğŸ‘¤ ÙˆÛ•Ø±Ú¯Ø±: ${userPh}`;
            const formData = new FormData();
            formData.append("chat_id", CHAT_ID);
            formData.append("photo", imgFile);
            formData.append("caption", caption);
            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, { method: "POST", body: formData });

            alert("Ø¦Û†Ø±Ø¯Û•Ø±Û•Ú©Û•Øª Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ù†ÛØ±Ø¯Ø±Ø§! Ú©Û†Ø¯: #" + orderID);
        } catch(e) { alert("Ù‡Û•ÚµÛ•ÛŒÛ•Ú© Ú•ÙˆÙˆÛŒØ¯Ø§!"); }
        finally { btn.disabled = false; btn.innerText = "Ù†Ø§Ø±Ø¯Ù†ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ"; }
    }

    db.ref('orders').on('value', (snap) => {
        const data = snap.val();
        let html = "";
        if (data) {
            Object.values(data).reverse().slice(0, 8).forEach(o => {
                let color = o.status === 'accepted' ? 'var(--success)' : o.status === 'rejected' ? 'var(--danger)' : 'var(--main)';
                let statusText = o.status === 'pending' ? '(Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†Û•)' : o.status === 'accepted' ? '(ØªÛ•ÙˆØ§Ùˆ Ø¨ÙˆÙˆ âœ…)' : '(Ú•Û•ØªÚ©Ø±Ø§ÙˆÛ• âŒ)';

                html += `
                    <div class="hist-item" style="border-right-color: ${color}">
                        <div class="hist-header">
                            <b style="color:var(--main)">#${o.orderID}</b>
                            <span style="color:${color}; font-weight:bold; font-size:11px;">${statusText}</span>
                        </div>
                        <div class="hist-row">
                            <i class="fas fa-paper-plane" style="color:#60a5fa; width:15px"></i>
                            <span>Ø¨Ú•ÛŒ Ù†ÛØ±Ø¯Ø±Ø§Ùˆ: <b>${o.amt}</b> <small style="color:#94a3b8;">(${o.from})</small></span>
                        </div>
                        <div class="hist-row">
                            <i class="fas fa-hand-holding-usd" style="color:var(--success); width:15px"></i>
                            <span>Ø¨Ú•ÛŒ ÙˆÛ•Ø±Ú¯ÛŒØ±Ø§Ùˆ: <b style="color:var(--success)">${o.total}</b></span>
                        </div>
                        <div class="hist-row">
                            <i class="fas fa-user-circle" style="color:var(--main); width:15px"></i>
                            <span>Ú˜Ù…Ø§Ø±Û•ÛŒ ÙˆÛ•Ø±Ú¯Ø±: <b>${o.userPh}</b></span>
                        </div>
                        <div class="hist-row" style="margin-top:10px; padding-top:8px; border-top:1px dotted rgba(255,255,255,0.1); font-size:10px; color:#94a3b8">
                            <i class="fas fa-calendar-alt" style="width:15px"></i>
                            <span>Ú©Ø§Øª: ${o.time}</span>
                        </div>
                    </div>`;
            });
        }
        document.getElementById('historyList').innerHTML = html || "<p style='text-align:center; opacity:0.5;'>Ù‡ÛŒÚ† Ù…Ø§Ù…Û•ÚµÛ•ÛŒÛ•Ú© Ù†ÛŒÛŒÛ•</p>";
    });
</script>
</body>
</html>
