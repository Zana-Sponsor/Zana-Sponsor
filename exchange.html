<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zana Exchange | v2.2.1 Stable</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --main: #facc15; --bg: #0f172a; --card: #1e293b; --success: #10b981; --gold: linear-gradient(135deg, #facc15 0%, #eab308 100%); }
        body { font-family: 'Tahoma', sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; text-align: right; overflow-x: hidden; }
        .container { max-width: 400px; margin: auto; animation: fadeIn 0.6s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .version-badge { display: inline-block; background: rgba(250, 204, 21, 0.1); color: var(--main); font-size: 10px; padding: 2px 8px; border-radius: 20px; border: 1px solid var(--main); margin-top: 5px; font-family: monospace; }
        .support-header { max-width: 400px; margin: 0 auto 15px auto; background: rgba(37, 211, 102, 0.1); border: 1px solid #25d366; padding: 10px; border-radius: 15px; text-align: center; }
        .support-link { text-decoration: none; color: #25d366; font-weight: bold; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .card { background: var(--card); padding: 25px; border-radius: 25px; border: 1px solid #334155; box-shadow: 0 15px 35px rgba(0,0,0,0.5); position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 5px; background: var(--gold); }
        .logo-section { text-align: center; margin-bottom: 25px; }
        .logo-circle { width: 70px; height: 70px; background: var(--gold); margin: 0 auto 10px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid #0f172a; }
        .logo-circle i { font-size: 30px; color: #0f172a; }
        .logo-title { font-size: 20px; font-weight: 900; background: var(--gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; display: block; }
        .wallet { background: rgba(15, 23, 42, 0.8); padding: 15px; border-radius: 18px; text-align: center; border: 1px solid var(--main); margin-bottom: 20px; }
        .num { font-size: 16px; font-weight: bold; color: #fff; display: block; margin: 5px 0; font-family: monospace; }
        .copy-btn { background: var(--main); border: none; padding: 6px 15px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 11px; }
        .group { margin-bottom: 15px; }
        label { display: block; font-size: 12px; color: #94a3b8; margin-bottom: 5px; font-weight: bold; }
        select, input { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #334155; background: #0f172a; color: white; outline: none; box-sizing: border-box; font-size: 14px; }
        .res-box { background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 18px; margin: 15px 0; border: 1px solid var(--success); text-align: center; }
        .total { font-size: 22px; font-weight: bold; color: var(--success); }
        .file-label { display: flex; align-items: center; justify-content: center; gap: 10px; background: #334155; padding: 12px; border-radius: 12px; text-align: center; cursor: pointer; border: 1px dashed var(--main); font-size: 13px; color: #fff; }
        #imageInput { display: none; }
        #imagePreview { width: 100%; border-radius: 12px; margin-top: 10px; display: none; border: 2px solid var(--main); }
        .btn { background: var(--gold); color: #000; border: none; width: 100%; padding: 16px; border-radius: 15px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .history-section { margin-top: 25px; background: #1e293b; padding: 15px; border-radius: 20px; border: 1px solid #334155; }
        .history-title { font-size: 14px; color: var(--main); margin-bottom: 10px; font-weight: bold; }
        .hist-item { background: #0f172a; padding: 12px; border-radius: 12px; margin-bottom: 8px; font-size: 11px; border-right: 4px solid var(--main); }
        .footer { text-align: center; margin-top: 20px; font-size: 10px; color: #64748b; padding-bottom: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div class="support-header">
        <a href="https://wa.me/9647758887488?text=Ø³ÚµØ§Ùˆ" class="support-link"><i class="fab fa-whatsapp"></i> Ø¨Û† Ù‡Û•Ø± Ú©ÛØ´Û•ÛŒÛ•Ú© (WhatsApp Support)</a>
    </div>

    <div class="card">
        <div class="logo-section">
            <div class="logo-circle"><i class="fas fa-random"></i></div>
            <span class="logo-title">ZANA EXCHANGE</span>
            <span class="version-badge">v2.2.1 Stable</span>
        </div>

        <div class="wallet">
            <span style="font-size: 10px; color: var(--main); font-weight: bold;">Ø¨Û† Ù†Ø§Ø±Ø¯Ù†ÛŒ Ù¾Ø§Ø±Û• (Send Money To)</span>
            <span class="num" id="myNum">07510074008</span>
            <button class="copy-btn" onclick="copyNum()"><i class="fas fa-copy"></i> Ú©Û†Ù¾ÛŒ Ø¨Ú©Û•</button>
        </div>

        <div class="group"><label>Ù„Û• Ú©ÙˆÛÙˆÛ• Ø¯Û•ÛŒÙ†ÛØ±ÛŒØªØŸ (From)</label>
            <select id="from" onchange="updateWallet()">
                <option value="ÙØ§Ø³ØªÙ¾Û•ÛŒ (FastPay)">ÙØ§Ø³ØªÙ¾Û•ÛŒ (FastPay)</option>
                <option value="Ø¦ÛÙ Ø¦Ø§ÛŒ Ø¨ÛŒ (FIB)">Ø¦ÛÙ Ø¦Ø§ÛŒ Ø¨ÛŒ (FIB)</option>
                <option value="Ú©ÙŠ Ú©Ø§Ø±Ø¯ (QiCard)">Ú©ÙŠ Ú©Ø§Ø±Ø¯ (QiCard)</option>
                <option value="USDT (TRC-20)">ØªÛØ²Û•Ø± USDT (TRC-20)</option>
                <option value="Ú©Û†Ú•Û•Ú© (Korek)">Ú©Û†Ú•Û•Ú© (Korek Card)</option>
            </select>
        </div>

        <div class="group"><label>Ú˜Ù…Ø§Ø±Û•ÛŒ Ù†ÛØ±Û•Ø± (Sender Number)</label><input type="text" id="senderPhone" placeholder="07XXXXXXXX"></div>
        <div class="group"><label>Ø¨Û† Ú©ÙˆÛ Ø¨Ú¯Û†Ú•Ø¯Ø±ÛØªØŸ (To)</label>
            <select id="to" onchange="calc()">
                <option value="Ø¦ÛÙ Ø¦Ø§ÛŒ Ø¨ÛŒ (FIB)">Ø¦ÛÙ Ø¦Ø§ÛŒ Ø¨ÛŒ (FIB)</option>
                <option value="ÙØ§Ø³ØªÙ¾Û•ÛŒ (FastPay)">ÙØ§Ø³ØªÙ¾Û•ÛŒ (FastPay)</option>
                <option value="Ú©ÙŠ Ú©Ø§Ø±Ø¯ (QiCard)">Ú©ÙŠ Ú©Ø§Ø±Ø¯ (QiCard)</option>
            </select>
        </div>
        <div class="group"><label id="amtLabel">Ø¨Ú•ÛŒ Ù†Ø§Ø±Ø¯Ù† (Amount)</label><input type="number" id="amt" placeholder="100000" oninput="calc()"></div>

        <div class="res-box"><span class="total" id="total">0 Ø¯ÛŒÙ†Ø§Ø±</span><div style="font-size: 11px; color: #94a3b8; margin-top: 5px;" id="feeText">(Ø¹Ù…ÙˆÙ„Û• 2% Fee)</div></div>

        <div class="group"><label>Ú˜Ù…Ø§Ø±Û•ÛŒ ÙˆÛ•Ø±Ú¯Ø± (Receiver No.)</label><input type="text" id="userPhone" placeholder="07XXXXXXXX"></div>
        <div class="group"><label>ÙˆÛÙ†Û•ÛŒ ÙˆÛ•Ø³Úµ (Attachment)</label><label for="imageInput" class="file-label"><i class="fas fa-camera"></i> Ù„ÛØ±Û• ÙˆÛÙ†Û•ÛŒ ÙˆÛ•Ø³ÚµÛ•Ú©Û• Ø¯Ø§Ø¨Ù†Û</label><input type="file" id="imageInput" accept="image/*" onchange="previewImg()"><img id="imagePreview"></div>

        <button class="btn" id="submitBtn" onclick="processOrder()"><i class="fas fa-paper-plane"></i> Ù†Ø§Ø±Ø¯Ù†ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ (Submit)</button>
    </div>

    <div class="history-section" id="historySection" style="display: none;"><div class="history-title"><i class="fas fa-history"></i> Ù…ÛÚ˜ÙˆÙˆ (Recent History)</div><div id="historyList"></div></div>
    <div class="footer">Design & Dev by Zana Adam â“’ 2026</div>
</div>

<script>
    // --- Firebase Configuration ---
    const firebaseConfig = {
        apiKey: "AIzaSyB056_g2Y3AJjtjG9715FgtXIhtjFcMPPU",
        authDomain: "zana-exchange.firebaseapp.com",
        databaseURL: "https://zana-exchange-default-rtdb.firebaseio.com",
        projectId: "zana-exchange",
        storageBucket: "zana-exchange.firebasestorage.app",
        messagingSenderId: "107338028455",
        appId: "1:107338028455:web:af6f4fb82ed3d7bdd85282"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const BOT_TOKEN = "8570457708:AAG_5hFu-octgBn1ruDJ3_OzEG7p4fWiNgo";
    const CHAT_ID = "6259019006";

    function updateWallet() {
        const from = document.getElementById('from').value;
        const numElem = document.getElementById('myNum');
        if(from.includes("Ú©Û†Ú•Û•Ú©") || from.includes("FastPay") || from.includes("FIB")) { numElem.innerText = "07510074008"; }
        else if(from.includes("QiCard")) { numElem.innerText = "07758887488"; }
        else if(from.includes("USDT")) { numElem.innerText = "TTaNnxWNt2bjgSvpRY7NpvyCHUXDi6wjYc"; }
        calc();
    }

    function calc() {
        const from = document.getElementById('from').value;
        const to = document.getElementById('to').value;
        const amt = parseFloat(document.getElementById('amt').value) || 0;
        let result = from.includes("Ú©Û†Ú•Û•Ú©") ? (amt / 100000) * 82000 : from.includes("USDT") ? (amt * 148000 / 100) * 0.98 : amt * 0.98;
        document.getElementById('total').innerText = Math.floor(result).toLocaleString() + " Ø¯ÛŒÙ†Ø§Ø±";
    }

    function previewImg() {
        const file = document.getElementById('imageInput').files[0];
        if (file) { document.getElementById('imagePreview').src = URL.createObjectURL(file); document.getElementById('imagePreview').style.display = "block"; }
    }

    function copyNum() {
        navigator.clipboard.writeText(document.getElementById('myNum').innerText);
        alert("Ú©Û†Ù¾ÛŒ Ú©Ø±Ø§ âœ…");
    }

    async function processOrder() {
        const from = document.getElementById('from').value;
        const to = document.getElementById('to').value;
        const senderPh = document.getElementById('senderPhone').value;
        const amt = document.getElementById('amt').value;
        const total = document.getElementById('total').innerText;
        const userPh = document.getElementById('userPhone').value;
        const imgFile = document.getElementById('imageInput').files[0];
        const btn = document.getElementById('submitBtn');

        if(!amt || !senderPh || !userPh || !imgFile) return alert("ØªÚ©Ø§ÛŒÛ• Ù‡Û•Ù…ÙˆÙˆ Ø²Ø§Ù†ÛŒØ§Ø±ÛŒÛŒÛ•Ú©Ø§Ù† Ù¾Ú• Ø¨Ú©Û•Ø±Û•ÙˆÛ•");

        btn.disabled = true;
        btn.innerHTML = 'Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù† Ø¨Û•...';

        const orderID = Math.floor(10000 + Math.random() * 90000);
        const time = new Date().toLocaleString('ku-IQ');

        // 1. Save to Firebase
        try {
            await db.ref('orders/' + orderID).set({
                orderID, from, to, senderPh, amt, total, userPh, time, status: 'pending'
            });
            
            // 2. Send to Telegram
            const caption = `ğŸ†” Order: #${orderID}\nğŸ“± From: ${senderPh}\nğŸ“ Amount: ${amt}\nğŸ§ Gateway: ${from}\nğŸ” Swap To: ${to}\nğŸ’° Receive: ${total}\nğŸ“± Receiver: ${userPh}`;
            const formData = new FormData();
            formData.append("chat_id", CHAT_ID);
            formData.append("photo", imgFile);
            formData.append("caption", caption);
            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, { method: "POST", body: formData });

            saveHistory({ id: orderID, from, to, total, time });
            alert("Ø¦Û†Ø±Ø¯Û•Ø±Û•Ú©Û• Ù†ÛØ±Ø¯Ø±Ø§ Ùˆ Ù¾Ø§Ø´Û•Ú©Û•ÙˆØª Ú©Ø±Ø§ âœ…");
            
            const targetWA = (from.includes("QiCard") || from.includes("USDT")) ? "9647758887488" : "9647510074008";
            window.location.href = `https://wa.me/${targetWA}?text=${encodeURIComponent(caption)}`;
        } catch (e) { alert("Ù‡Û•ÚµÛ•ÛŒÛ•Ú© Ú•ÙˆÙˆÛŒØ¯Ø§!"); }
        finally { btn.disabled = false; btn.innerHTML = 'Ù†Ø§Ø±Ø¯Ù†ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ'; }
    }

    function saveHistory(item) {
        let history = JSON.parse(localStorage.getItem('zana_hist') || "[]");
        history.unshift(item);
        localStorage.setItem('zana_hist', JSON.stringify(history.slice(0, 5)));
        renderHistory();
    }

    function renderHistory() {
        const history = JSON.parse(localStorage.getItem('zana_hist') || "[]");
        if(history.length > 0) {
            document.getElementById('historySection').style.display = "block";
            document.getElementById('historyList').innerHTML = history.map(h => `
                <div class="hist-item"><b>#${h.id}</b> | ${h.from} â” ${h.to}<br><span style="color:var(--success)">Ø¨Ú•: ${h.total}</span></div>
            `).join('');
        }
    }
    window.onload = renderHistory;
</script>
</body>
</html>
